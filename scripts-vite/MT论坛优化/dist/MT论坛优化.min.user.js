// ==UserScript==
// @name         MTè®ºå›ä¼˜åŒ–
// @namespace    https://github.com/WhiteSevs/TamperMonkeyScript
// @version      2024.11.19
// @author       WhiteSevs
// @description  MTè®ºå›æ•ˆæœå¢å¼ºï¼Œå¦‚è‡ªåŠ¨ç­¾åˆ°ã€è‡ªåŠ¨å±•å¼€å¸–å­ã€ç”¨æˆ·çŠ¶æ€æŸ¥çœ‹ã€ç¾åŒ–å¯¼èˆªã€åŠ¨æ€å¤´åƒä¸Šä¼ ã€æœ€æ–°å‘è¡¨ã€è¯„è®ºè¿‡æ»¤å™¨ç­‰
// @license      GPL-3.0-only
// @icon         data:image/png;base64,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
// @supportURL   https://github.com/WhiteSevs/TamperMonkeyScript/issues
// @match        *://bbs.binmt.cc/*
// @exclude      /^http(s|)://bbs.binmt.cc/uc_server.*$/
// @require      https://update.greasyfork.org/scripts/494167/1413255/CoverUMD.js
// @require      https://fastly.jsdelivr.net/npm/@whitesev/utils@2.5.3/dist/index.umd.js
// @require      https://fastly.jsdelivr.net/npm/@whitesev/domutils@1.4.2/dist/index.umd.js
// @require      https://fastly.jsdelivr.net/npm/@whitesev/pops@1.9.0/dist/index.umd.js
// @require      https://fastly.jsdelivr.net/npm/qmsg@1.2.7/dist/index.umd.js
// @require      https://fastly.jsdelivr.net/npm/viewerjs@1.11.6/dist/viewer.min.js
// @require      https://fastly.jsdelivr.net/npm/@highlightjs/cdn-assets@11.10.0/highlight.min.js
// @resource     HljsCSS    https://fastly.jsdelivr.net/npm/highlight.js@11.10.0/styles/github-dark.min.css
// @resource     ViewerCSS  https://fastly.jsdelivr.net/npm/viewerjs@1.11.6/dist/viewer.min.css
// @connect      *
// @grant        GM_addStyle
// @grant        GM_deleteValue
// @grant        GM_getResourceText
// @grant        GM_getValue
// @grant        GM_info
// @grant        GM_registerMenuCommand
// @grant        GM_setValue
// @grant        GM_unregisterMenuCommand
// @grant        GM_xmlhttpRequest
// @grant        unsafeWindow
// @run-at       document-start
// ==/UserScript==

(t=>{function n(d){if(typeof d!="string")throw new TypeError("cssText must be a string");let e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=d,document.head?document.head.appendChild(e):document.body?document.body.appendChild(e):document.documentElement.childNodes.length===0?document.documentElement.appendChild(e):document.documentElement.insertBefore(e,document.documentElement.childNodes[0]),e}if(typeof GM_addStyle=="function"){GM_addStyle(t);return}n(t)})(" .pls .avatar img,.avtm img{border-radius:10%}.pls .avatar img{--avatar-size: 90px;width:var(--avatar-size);height:var(--avatar-size)} ");

(function (A, Ae, j, te, Q, Me) {
        'use strict';

        var be=Object.defineProperty;var ye=(t,e,l)=>e in t?be(t,e,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[e]=l;var _e=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var Z=(t,e,l)=>ye(t,e+"",l);var Fe=_e((we,ne)=>{var ae=typeof GM_deleteValue<"u"?GM_deleteValue:void 0,oe=typeof GM_getResourceText<"u"?GM_getResourceText:void 0,q=typeof GM_getValue<"u"?GM_getValue:void 0,X=typeof GM_info<"u"?GM_info:void 0,ke=typeof GM_registerMenuCommand<"u"?GM_registerMenuCommand:void 0,B=typeof GM_setValue<"u"?GM_setValue:void 0,Se=typeof GM_unregisterMenuCommand<"u"?GM_unregisterMenuCommand:void 0,Te=typeof GM_xmlhttpRequest<"u"?GM_xmlhttpRequest:void 0,L=typeof unsafeWindow<"u"?unsafeWindow:void 0,Ce=window;const $e={$data:{get enable(){return w.getValue("httpx-use-cookie-enable")},get useDocumentCookie(){return w.getValue("httpx-use-document-cookie")},cookieRule:[]},fixCookieSplit(t){return v.isNotNull(t)&&!t.trim().endsWith(";")&&(t+=";"),t},concatCookie(t,e){return v.isNull(t)?e:(t=t.trim(),e=e.trim(),t=this.fixCookieSplit(t),e.startsWith(";")&&(e=e.substring(1)),t.concat(e))},handle(t){if(t.fetch||!this.$data.enable)return;let e="",l=t.url;l.startsWith("//")&&(l=window.location.protocol+l);let r=new URL(l);this.$data.useDocumentCookie&&r.hostname.endsWith(window.location.hostname.split(".").slice(-2).join("."))&&(e=this.concatCookie(e,document.cookie.trim()));for(let a=0;a<this.$data.cookieRule.length;a++){let s=this.$data.cookieRule[a];if(r.hostname.match(s.hostname)){let n=w.getValue(s.key);if(v.isNull(n))break;e=this.concatCookie(e,n);}}v.isNotNull(e)&&(t.headers&&t.headers.Cookie?t.headers.Cookie=this.concatCookie(t.headers.Cookie,e):t.headers.Cookie=e,x.info(["Httpx => è®¾ç½®cookie:",t])),t.headers&&t.headers.Cookie!=null&&v.isNull(t.headers.Cookie)&&delete t.headers.Cookie;}},re={addBlockCSS(...t){let e=[];if(t.length!==0&&!(t.length===1&&typeof t[0]=="string"&&t[0].trim()===""))return t.forEach(l=>{Array.isArray(l)?e=e.concat(l):e.push(l);}),H(`${e.join(`,
`)}{display: none !important;}`)},setGMResourceCSS(t){let e=typeof oe=="function"?oe(t.keyName):"";typeof e=="string"&&e?H(e):re.loadStyleLink(t.url);},async loadStyleLink(t){let e=document.createElement("link");e.rel="stylesheet",e.type="text/css",e.href=t,f.ready(()=>{document.head.appendChild(e);});},async loadScript(t){let e=document.createElement("script");return e.src=t,new Promise(l=>{e.onload=()=>{l(null);},(document.head||document.documentElement).appendChild(e);})},fixUrl(t){return t=t.trim(),t.match(/^http(s|):\/\//i)||(t.startsWith("/")||(t+="/"),t=window.location.origin+t),t},fixHttps(t){if(t.startsWith("https://")||!t.startsWith("http://"))return t;let e=new URL(t);return e.protocol="https:",e.toString()}},he={ElementPlus:{keyName:"ElementPlusResourceCSS",url:"https://fastly.jsdelivr.net/npm/element-plus@latest/dist/index.min.css"},Viewer:{keyName:"ViewerCSS",url:"https://fastly.jsdelivr.net/npm/viewerjs@latest/dist/viewer.min.css"},Hljs:{keyName:"HljsCSS",url:"https://fastly.jsdelivr.net/npm/highlight.js@latest/styles/github-dark.min.css"}};(function(t,e){typeof we=="object"&&typeof ne<"u"?ne.exports=e():(t=typeof globalThis<"u"?globalThis:t||self,t.Watermark=e(t.Watermark));})(typeof window<"u"?window:void 0,function(t){let e=function(){};CanvasRenderingContext2D.prototype.letterSpacingText=function(n,i,o,c){var d=this,p=d.canvas;if(!c&&p&&(c=parseFloat(window.getComputedStyle(p).letterSpacing)),!c)return this.fillText(n,i,o);var m=n.split(""),u=d.textAlign||"left",h=d.measureText(n).width,g=h+c*(m.length-1);u=="center"?i=i-g/2:u=="right"&&(i=i-g),d.textAlign="left",m.forEach(function(y){var b=d.measureText(y).width;d.fillText(y,i,o),i=i+b+c;}),d.textAlign=u;},CanvasRenderingContext2D.prototype.wrapText=function(n,i,o,c,d,p){if(!(typeof n!="string"||typeof i!="number"||typeof o!="number")){var m=this,u=m.canvas;typeof c>"u"&&(c=u&&u.width||300),typeof d>"u"&&(d=u&&parseInt(window.getComputedStyle(u).lineHeight)||parseInt(window.getComputedStyle(document.body).lineHeight));for(var h=n.split(""),g="",y=0;y<h.length;y++){var b=g+h[y],_=m.measureText(b),T=_.width;T>c&&y>0?(p?m.strokeText(g,i,o,u.width):m.fillText(g,i,o),g=h[y],o+=d):g=b;}p?m.strokeText(g,i,o,u.width):m.fillText(g,i,o);}},CanvasRenderingContext2D.prototype.fillTextVertical=function(n,i,o){var c=this;c.canvas;var d=n.split(""),p=d.map(function(h){return c.measureText(h).width}),m=c.textAlign,u=c.textBaseline;m=="left"?i=i+Math.max.apply(null,p)/2:m=="right"&&(i=i-Math.max.apply(null,p)/2),u=="bottom"||u=="alphabetic"||u=="ideographic"?o=o-p[0]/2:(u=="top"||u=="hanging")&&(o=o+p[0]/2),c.textAlign="center",c.textBaseline="middle",d.forEach(function(h,g){var b=p[g],y=h.charCodeAt(0);y<=256?(c.translate(i,o),c.rotate(90*Math.PI/180),c.translate(-i,-o)):g>0&&n.charCodeAt(g-1)<256&&(o=o+p[g-1]/2),c.fillText(h,i,o),c.setTransform(1,0,0,1,0,0);var b=p[g];o=o+b;}),c.textAlign=m,c.textBaseline=u;};function l(n){let i=new FileReader;return new Promise(o=>{i.onloadend=async function(c){o(c);},i.readAsDataURL(n);})}function r(n){let i=new Image;return new Promise(o=>{i.onload=()=>{o(i);},i.src=n;})}function a(n,i,o){let c=!1;return Array.from(n).forEach(d=>{if(d.x==i&&d.y==o){c=!0;return}}),c}function s(n){return n instanceof Array?n[Math.floor(Math.random()*n.length)]:n}return e.prototype.setFile=function(n){let i=this;return new Promise(async o=>{try{var c=await l(n);await i.setImage(c.target.result),o(!0);}catch{o(!1);}})},e.prototype.setImage=function(n){this.dataUrl=n;let i=this;return new Promise(async o=>{var c=await r(n);i.sizes={width:c.width,height:c.height};var d=document.createElement("canvas");d.width=i.sizes.width,d.height=i.sizes.height;var p=d.getContext("2d");p.drawImage(c,0,0),c=null,i.canvas=d,o(!0);})},e.prototype.hasImage=function(){return !!this.dataUrl},e.prototype.getSize=function(){return this.sizes},e.prototype.clearMark=function(){let n=this;if(typeof n.canvas>"u")return;function i(){var o=n.canvas.getContext("2d");o.clearRect(0,0,n.canvas.width,n.canvas.height);var c=n.canvas.width,d=n.canvas.height;n.canvas.width=c,n.canvas.height=d,o.beginPath();var p=new Image;p.src=n.dataUrl,o.drawImage(p,0,0),p=null;}i();},e.prototype.addText=function(n){var i={text:["Call By waterMark.addText"],fontSize:"6vw",fontFamily:"Microsoft Yahei",color:"#000000",textAlign:"center",stroke:!1,globalAlpha:.7,rotateAngle:50,maxWidth:100,xMoveDistance:30,yMoveDistance:30};for(let $ in i)typeof n[$]<"u"&&(i[$]=n[$]);i.maxWidth=parseInt(i.maxWidth)>0?i.maxWidth:1,i.xMoveDistance=parseInt(i.xMoveDistance)>0?i.xMoveDistance:1,i.yMoveDistance=parseInt(i.yMoveDistance)>0?i.yMoveDistance:1;var o=this.canvas.getContext("2d"),c=i.fontSize;c=c.toString(),~c.indexOf("vw")&&(c=(this.sizes.width/100*parseInt(c)).toFixed(0)),c=parseInt(c),o.font=c+"px "+i.fontFamily,o.fillStyle=i.color,o.textAlign=i.textAlign,o.globalAlpha=i.globalAlpha;let d=this.sizes.width,p=this.sizes.height,m=i.rotateAngle*Math.PI/180,u=i.xMoveDistance,h=i.yMoveDistance,g=i.maxWidth,y=c,b=[];for(var _=d/2;_<d;_+=u){for(var T=p/2;T<p;T+=h)a(b,_,T)||(b=b.concat({x:_,y:T}),o.setTransform(1,0,0,1,0,0),o.translate(_,T),o.rotate(m),o.wrapText(s(i.text),0,0,g,y,i.stroke));for(var C=p/2;C>0;C-=h)a(b,_,C)||(b=b.concat({x:_,y:C}),o.setTransform(1,0,0,1,0,0),o.translate(_,C),o.rotate(m),o.wrapText(s(i.text),0,0,g,y,i.stroke));}for(var _=d/2;_>0;_-=u){for(var T=p/2;T<p;T+=h)a(b,_,T)||(b=b.concat({x:_,y:T}),o.setTransform(1,0,0,1,0,0),o.translate(_,T),o.rotate(m),o.wrapText(s(i.text),0,0,g,y,i.stroke));for(var C=p/2;C>0;C-=h)a(b,_,C)||(b=b.concat({x:_,y:C}),o.setTransform(1,0,0,1,0,0),o.translate(_,C),o.rotate(m),o.wrapText(s(i.text),0,0,g,y,i.stroke));}},e.prototype.addPixelText=function(n){var i={text:"åƒç´ æ–‡å­—æ°´å°",big:{fontSize:150,fontFamily:"å¾®è½¯é›…é»‘",textAlign:"center",rotateAngle:0,stroke:!1},small:{fontSize:10,fontFamily:"å¾®è½¯é›…é»‘",color:"#000",textAlign:"center",globalAlpha:.7}};for(let _ in i)typeof n[_]<"u"&&(i[_]=n[_]);var o=this.canvas.getContext("2d"),c=document.createElement("canvas"),d=c.getContext("2d");c.width=this.sizes.width,c.height=this.sizes.height,d.font=i.big.fontSize+"px "+i.big.fontFamily,d.textAlign=i.big.textAlign,d.textBaseline="middle",d.translate(c.width/2,c.height/2),d.rotate(i.big.rotateAngle*Math.PI/180),d.translate(-c.width/2,-c.height/2),i.big.stroke?d.strokeText(i.text,c.width/2,c.height/2,c.width):d.fillText(i.text,c.width/2,c.height/2);for(var p=i.text.split(""),m=d.getImageData(0,0,c.width,c.height),u=[],h=0;h<c.height;h+=i.small.fontSize)for(var g=0;g<c.width;g+=i.small.fontSize){var y=g+h*c.width,b=m.data[y*4+3];b>128&&u.push({text:s(p),x:g,y:h});}o.font=i.small.fontSize+"px "+i.small.fontFamily,o.fillStyle=i.small.color,o.textAlign=i.small.textAlign,o.textBaseline="middle",o.globalAlpha=i.small.globalAlpha,u.forEach(_=>{o.fillText(_.text,_.x,_.y);});},e.prototype.addImage=function(n){if(n.imageArray==null)return alert("å‚æ•°ç¼ºå°‘imageArray"),!1;if(n.imageArray.length===0)return alert("å‚æ•°imageArrayä¸èƒ½ä¸ºç©º"),!1;let i={imageArray:[],width:50,height:50,globalAlpha:.5,rotateAngle:0,xMoveDistance:70,yMoveDistance:70};for(let k in i)typeof n[k]<"u"&&(i[k]=n[k]);i.width=parseInt(i.width)>0?i.width:1,i.height=parseInt(i.height)>0?i.height:1,i.xMoveDistance=parseInt(i.xMoveDistance)>0?i.xMoveDistance:1,i.yMoveDistance=parseInt(i.yMoveDistance)>0?i.yMoveDistance:1;let o=this.canvas.getContext("2d"),c=[],d=parseInt(Math.sqrt(i.width*i.width+i.height*i.height)),p=this.sizes.width,m=this.sizes.height,u=i.rotateAngle*Math.PI/180,h=i.xMoveDistance,g=i.yMoveDistance,y=p/2-d/2,b=m/2-d/2,_=(d-i.width)/2,T=(d-i.height)/2;Array.from(i.imageArray).forEach(k=>{var M=document.createElement("canvas"),V=M.getContext("2d");M.width=d,M.height=d,V.globalAlpha=i.globalAlpha,V.translate(d/2,d/2),V.rotate(u),V.translate(-d/2,-d/2),V.drawImage(k,_,T,i.width,i.height),c=c.concat(M);});function C(k){return k[Math.floor(Math.random()*k.length)]}o.setTransform(1,0,0,1,0,0);let $=[];for(let k=y;k<p;k+=h){for(let M=b;M<m;M+=g)a($,k,M)||($=$.concat({x:k,y:M}),o.drawImage(C(c),k,M));for(let M=b;M>-Math.abs(d);M-=g)a($,k,M)||($=$.concat({x:k,y:M}),o.drawImage(C(c),k,M));}for(let k=y;k>-Math.abs(d);k-=h){for(let M=b;M<m;M+=g)a($,k,M)||($=$.concat({x:k,y:M}),o.drawImage(C(c),k,M));for(let M=b;M>-Math.abs(d);M-=g)a($,k,M)||($=$.concat({x:k,y:M}),o.drawImage(C(c),k,M));}},e.prototype.getPreview=function(){return this.dataUrl},e.prototype.render=function(n){return n=n==="png"?"png":"jpeg",this.canvas.toDataURL("image/"+n)},e.prototype.renderBlob=function(){let n=this;return new Promise(i=>{n.canvas.toBlob(function(o){i(window.URL.createObjectURL(o));});})},e.prototype.noConflict=function(){return window.Watermark&&delete window.Watermark,t&&(window.Watermark=t),e},e});const Ie="MTè®ºå›ä¼˜åŒ–",v=j.noConflict(),f=Ae.noConflict(),R=te,x=new v.Log(X,L.console||Ce.console);var pe;const se=((pe=X==null?void 0:X.script)==null?void 0:pe.name)||Ie,me=!1;x.config({debug:me,logMaxCount:1e3,autoClearConsole:!0,tag:!0});A.config(Object.defineProperties({html:!0,autoClose:!0,showClose:!1},{position:{get(){return w.getValue("qmsg-config-position","bottom")}},maxNums:{get(){return w.getValue("qmsg-config-maxnums",5)}},showReverse:{get(){return w.getValue("qmsg-config-showreverse",!0)}},zIndex:{get(){let t=j.getMaxZIndex(),e=te.config.InstanceUtils.getPopsMaxZIndex().zIndex;return j.getMaxValue(t,e)+100}}}));const le=new v.GM_Menu({GM_getValue:q,GM_setValue:B,GM_registerMenuCommand:ke,GM_unregisterMenuCommand:Se}),P=new v.Httpx(Te);P.interceptors.request.use(t=>($e.handle(t),t));P.interceptors.response.use(void 0,t=>(x.error(["æ‹¦æˆªå™¨-è¯·æ±‚é”™è¯¯",t]),t.type==="onabort"?A.warning("è¯·æ±‚å–æ¶ˆ"):t.type==="onerror"?A.error("è¯·æ±‚å¼‚å¸¸"):t.type==="ontimeout"?A.error("è¯·æ±‚è¶…æ—¶"):A.error("å…¶å®ƒé”™è¯¯"),t));P.config({logDetails:me});te.GlobalConfig.setGlobalConfig({mask:{enable:!0,clickEvent:{toClose:!1,toHide:!1}}});L.Object.defineProperty,L.Function.prototype.apply,L.Function.prototype.call,L.Element.prototype.appendChild,L.setTimeout;const H=v.addStyle.bind(v);re.setGMResourceCSS(he.Viewer);re.setGMResourceCSS(he.Hljs);const Y=document.querySelector.bind(document),O=document.querySelectorAll.bind(document),N="GM_Panel",fe="data-init",F="data-key",W="data-default-value",Ee="data-init-more-value",S="data-storage-api",I=function(t,e,l,r,a,s){let n={text:t,type:"switch",description:a,attributes:{},props:{},getValue(){return !!this.props[S].get(e,l)},callback(i,o){let c=!!o;x.success(`${c?"å¼€å¯":"å…³é—­"} ${t}`),this.props[S].set(e,c);},afterAddToUListCallBack:s};return Reflect.set(n.attributes,F,e),Reflect.set(n.attributes,W,l),Reflect.set(n.props,S,{get(i,o){return w.getValue(i,o)},set(i,o){w.setValue(i,o);}}),n},ce=function(t,e,l,r,a,s){let n=[];typeof r=="function"?n=r():n=r;let i={text:t,type:"select",description:s,attributes:{},props:{},getValue(){return this.props[S].get(e,l)},callback(o,c,d){let p=c;x.info(`é€‰æ‹©ï¼š${d}`),this.props[S].set(e,p),typeof a=="function"&&a(o,p,d);},data:n};return Reflect.set(i.attributes,F,e),Reflect.set(i.attributes,W,l),Reflect.set(i.props,S,{get(o,c){return w.getValue(o,c)},set(o,c){w.setValue(o,c);}}),i},ge=function(t,e,l,r,a,s,n,i,o){return {text:t,type:"button",description:e,buttonIcon:r,buttonIsRightIcon:a,buttonIconIsLoading:s,buttonType:n,buttonText:l,callback(d){typeof i=="function"&&i(d);},afterAddToUListCallBack:o}},ue=function(t,e,l,r){let a={type:"own",attributes:{},props:l,getLiElementCallBack:t,afterAddToUListCallBack:r};return Reflect.set(a.attributes,fe,()=>!1),a},U={getAvatar:(t,e="middle")=>`/uc_server/avatar.php?uid=${t}&size=${e}&ts=1`,getCurrentUID(){let t=L.discuz_uid;if(typeof t=="string")return t;let e=document.querySelector('.sidenv_exit a[href*="uid="]');if(e){let l=e.href.match(/uid=([0-9]+)/);if(l)return l[l.length-1]}},getCurrentFormHash(){let t=document.querySelector('.comiis_user_info a[href*="&formhash="]');if(t){let e=t.href.match(/formhash=([0-9a-zA-Z]+)/);if(e)return e[e.length-1]}},envIsMobile(){return (L.STYLEID||window.STYLEID||typeof STYLEID<"u"&&STYLEID)==="3"},getThreadId:t=>{let e=t.match(/thread-([\d]+)-|&tid=([\d]+)/i);if(e){let l=e.filter(Boolean);return l[l.length-1]}},getForumId(t){let e=t.match(/&fid=([\d]+)/i);if(e)return e[e.length-1]},getPostId(t){let e=t.match(/&pid=([\d]+)/i);if(e)return e[e.length-1]},getRepquote(t){let e=t.match(/&repquote=([\d]+)/i);if(e)return e[e.length-1]}},z={$upload:{small:!1,middle:!1,big:!1},$data:{avatarInfo:{maxSize:2097152,small:{width:48,height:48},middle:{width:120,height:120},big:{width:200,height:250}}},$el:{$smallUpload:null,$middleUpload:null,$bigUpload:null,$smallStatus:null,$middleStatus:null,$bigStatus:null},$avatar:{get small(){return z.$el.$smallUpload.files[0]},get middle(){return z.$el.$middleUpload.files[0]},get big(){return z.$el.$bigUpload.files[0]}},init(){this.showView();},showView(){const t=this;let e=R.confirm({title:{text:"ä¿®æ”¹å¤´åƒ",position:"center"},content:{text:`
                <div class="avatar-container">
                    <p class="avatar-tip">1. å°å¤´åƒï¼ˆå›¾ç‰‡å®½é«˜é™åˆ¶æœ€å¤§å°ºå¯¸ï¼š48Ã—48ï¼‰</p>
                    <p class="avatar-upload-status" data-type="small">ğŸ¤¡è¯·å…ˆä¸Šä¼ å›¾ç‰‡</p>
                    <input type="file" class="avatar-upload" data-type="small" data-maxwidth="48" data-maxheight="48" accept="image/*">
                </div>
                <div class="avatar-container">
                    <p class="avatar-tip">2. ä¸­å¤´åƒï¼ˆå›¾ç‰‡å®½é«˜é™åˆ¶æœ€å¤§å°ºå¯¸ï¼š120Ã—120ï¼‰</p>
                    <p class="avatar-upload-status" data-type="middle">ğŸ¤¡è¯·å…ˆä¸Šä¼ å›¾ç‰‡</p>
                    <input type="file" class="avatar-upload" data-type="middle" data-maxwidth="120" data-maxheight="120" accept="image/*">
                </div>
                <div class="avatar-container">
                    <p class="avatar-tip">3. å¤§å¤´åƒï¼ˆå›¾ç‰‡å®½é«˜é™åˆ¶æœ€å¤§å°ºå¯¸ï¼š200Ã—250ï¼‰</p>
                    <p class="avatar-upload-status" data-type="big">ğŸ¤¡è¯·å…ˆä¸Šä¼ å›¾ç‰‡</p>
                    <input type="file" class="avatar-upload" data-type="big" data-maxwidth="200" data-maxheight="250" accept="image/*">
                </div>
                `,html:!0},btn:{ok:{text:"ä¸Šä¼ ",callback:async()=>{if(!t.$upload.small){A.error("è¯·ä¸Šä¼ å°å¤´åƒ");return}if(!t.$upload.middle){A.error("è¯·ä¸Šä¼ ä¸­å¤´åƒ");return}if(!t.$upload.big){A.error("è¯·ä¸Šä¼ å¤§å¤´åƒ");return}let l=A.loading("æ­£åœ¨å¤„ç†æ•°æ®ä¸­...");try{let r=await this.getUploadUrl();if(r==null)return;let a=U.getCurrentFormHash();if(a==null){A.error("è·å–formhashå¤±è´¥");return}let s={big:{base64:await v.parseFileToBase64(this.$avatar.big)},middle:{base64:await v.parseFileToBase64(this.$avatar.middle)},small:{base64:await v.parseFileToBase64(this.$avatar.small)}};Object.keys(s).forEach(o=>{let c=s[o];c.base64=c.base64.substring(c.base64.indexOf(",")+1);});let n=new FormData;n.append("Filedata",this.$avatar.big||""),n.append("confirm","ç¡®å®š"),n.append("avatar1",s.big.base64),n.append("avatar2",s.middle.base64),n.append("avatar3",s.small.base64),n.append("formhash",a),x.info("å¤´åƒçš„base64å­—ç¬¦ä¸²",s);let i=await P.post(r,{data:n,processData:!1,headers:{Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9","User-Agent":v.getRandomPCUA(),Host:window.location.hostname,Origin:window.location.origin,Referer:`${window.location.origin}/home.php?mod=spacecp&ac=avatar`}});if(!i.status)return;i.data.responseText.indexOf("window.parent.postMessage('success','*')")!=-1?(e.close(),A.success("ä¸Šä¼ æˆåŠŸ")):(x.error("ä¸Šä¼ å¤±è´¥",i),A.error(i.data.responseText,{timeout:6e3,isHTML:!1,html:!1}));}catch(r){x.error(r);}finally{l.close();}}}},mask:{enable:!0},width:window.innerWidth>500?"500px":"88vw",height:window.innerHeight>500?"500px":"80vh",style:`
            .avatar-container{
                display: flex;
                width: -webkit-fill-available;
                width: -moz-available;
                margin: 6px 10px;
                flex-direction: column;
            }
            .avatar-tip{
                float: left;
                font-weight: bold;
            }
            .avatar-upload-status {
                padding: 0px;
                padding-left: 10px;
                font-weight: bold;
                width: -webkit-fill-available;
                text-align: left;
                font-size: small;
            }
            .avatar-upload-status[data-success="false"]{
                color: red;
            }
            .avatar-upload-status[data-success="true"]{
                color: green;
            }
            .avatar-upload {
                margin: 20px 0px;
            }
            `});this.$el.$smallUpload=e.$shadowRoot.querySelector(".avatar-upload[data-type='small']"),this.$el.$middleUpload=e.$shadowRoot.querySelector(".avatar-upload[data-type='middle']"),this.$el.$bigUpload=e.$shadowRoot.querySelector(".avatar-upload[data-type='big']"),this.$el.$smallStatus=e.$shadowRoot.querySelector(".avatar-upload-status[data-type='small']"),this.$el.$middleStatus=e.$shadowRoot.querySelector(".avatar-upload-status[data-type='middle']"),this.$el.$bigStatus=e.$shadowRoot.querySelector(".avatar-upload-status[data-type='big']"),this.setUploadChangeEvent(this.$el.$smallUpload,this.$el.$smallStatus,this.$data.avatarInfo.small,()=>{this.$upload.small=!0;}),this.setUploadChangeEvent(this.$el.$middleUpload,this.$el.$middleStatus,this.$data.avatarInfo.middle,()=>{this.$upload.middle=!0;}),this.setUploadChangeEvent(this.$el.$bigUpload,this.$el.$bigStatus,this.$data.avatarInfo.big,()=>{this.$upload.big=!0;});},setUploadChangeEvent(t,e,l,r){f.on(t,"change",a=>{var c;if(!((c=t.files)!=null&&c.length))return;f.text(e,"ğŸ¤¡è·å–æ–‡ä»¶ä¿¡æ¯ä¸­..."),e.removeAttribute("data-success");let s=t.files[0],n=s.size,i=new Image,o=new FileReader;o.readAsDataURL(s),o.onload=function(d){i.src=d.target.result,i.onload=function(){if(i.width>l.width||i.height>l.height){t.value="",e.setAttribute("data-success","false"),f.text(e,`ğŸ¤¡æ ¡éªŒå¤±è´¥ ==> å›¾ç‰‡å°ºå¯¸ä¸ç¬¦åˆï¼Œå®½ï¼š${i.width} é«˜ï¼š${i.height}`);return}if(n>z.$data.avatarInfo.maxSize){t.value="",e.setAttribute("data-success","false"),f.text(e,`ğŸ¤¡æ ¡éªŒå¤±è´¥ ==> å›¾ç‰‡å¤§å°ä¸ç¬¦åˆï¼š${n}byteï¼Œé™åˆ¶æœ€å¤§ï¼š${z.$data.avatarInfo.maxSize}byte`);return}e.setAttribute("data-success","true"),f.text(e,`ğŸ¤£ é€šè¿‡ å®½:${i.width} é«˜:${i.height} å¤§å°(byte):${n}`),r();};};});},async getUploadUrl(){let t=await P.get("/home.php?mod=spacecp&ac=avatar",{headers:{"User-Agent":v.getRandomPCUA()}});if(!t.status)return;if(v.isNull(t.data.responseText)){A.error("åŠ¨æ€å¤´åƒï¼šè·å–ä¸Šä¼ åœ°å€å¤±è´¥");return}let e=t.data.responseText.match(/var[\s]*data[\s]*=[\s]*"(.+?)"/);if(e==null||e.length!=2){A.error("åŠ¨æ€å¤´åƒï¼šè·å–å˜é‡dataå¤±è´¥");return}let r=e[e.length-1].split(","),a=r[r.indexOf("src")+1].replace("images/camera.swf?inajax=1","index.php?m=user&a=rectavatar&base64=yes");return x.info("ä¸Šä¼ åœ°å€ï¼š"+a),a}},Re={id:"component-common",title:"é€šç”¨",forms:[{text:"",type:"forms",forms:[{text:"Toasté…ç½®",type:"deepMenu",forms:[{text:"",type:"forms",forms:[ce("Toastä½ç½®","qmsg-config-position","bottom",[{value:"topleft",text:"å·¦ä¸Šè§’"},{value:"top",text:"é¡¶éƒ¨"},{value:"topright",text:"å³ä¸Šè§’"},{value:"left",text:"å·¦è¾¹"},{value:"center",text:"ä¸­é—´"},{value:"right",text:"å³è¾¹"},{value:"bottomleft",text:"å·¦ä¸‹è§’"},{value:"bottom",text:"åº•éƒ¨"},{value:"bottomright",text:"å³ä¸‹è§’"}],(t,e,l)=>{x.info("è®¾ç½®å½“å‰Qmsgå¼¹å‡ºä½ç½®"+l);},"Toastæ˜¾ç¤ºåœ¨é¡µé¢ä¹å®«æ ¼çš„ä½ç½®"),ce("æœ€å¤šæ˜¾ç¤ºçš„æ•°é‡","qmsg-config-maxnums",3,[{value:1,text:"1"},{value:2,text:"2"},{value:3,text:"3"},{value:4,text:"4"},{value:5,text:"5"}],void 0,"é™åˆ¶Toastæ˜¾ç¤ºçš„æ•°é‡"),I("é€†åºå¼¹å‡º","qmsg-config-showreverse",!1,void 0,"ä¿®æ”¹Toastå¼¹å‡ºçš„é¡ºåº")]}]}]},{text:"",type:"forms",forms:[{text:"åŠŸèƒ½",type:"deepMenu",forms:[{text:"",type:"forms",forms:[I("æ–°å¢ã€æœ€æ–°å‘è¡¨ã€‘","mt-addLatestPostBtn",!0,void 0,"ä¾¿äºå¿«æ·è·³è½¬"),I("è¶…é“¾æ¥æ–‡å­—è½¬æ¢","mt-link-text-to-hyperlink",!0,void 0,"è‡ªåŠ¨æŠŠç¬¦åˆè¶…é“¾æ¥æ ¼å¼çš„æ–‡å­—è½¬ä¸ºè¶…é“¾æ¥")]}]},{text:"å¤´åƒ",type:"deepMenu",forms:[{text:"<a href='https://ezgif.com/resize' target='_blank'>Resize Image</a>",type:"forms",forms:[ue(t=>{let e=f.createElement("div",{className:"pops-panel-item-left-text",innerHTML:`
											<p class="pops-panel-item-left-main-text">å¤´åƒï¼ˆæœ‰ç¼“å­˜ï¼‰</p>
											<p class="pops-panel-item-left-desc-text">å°ã€ä¸­ã€å¤§</p>
											`}),l=f.createElement("div",{className:"pops-panel-avatar-img",innerHTML:`
											<img 
												src="/uc_server/avatar.php?uid=${U.getCurrentUID()}&size=small"
												class="avatar-img" data-size="small">
											<img 
												src="/uc_server/avatar.php?uid=${U.getCurrentUID()}&size=middle"
												class="avatar-img" data-size="middle">
											<img 
												src="/uc_server/avatar.php?uid=${U.getCurrentUID()}&size=big"
												class="avatar-img" data-size="big">
											`}),r=f.createElement("style",{innerHTML:`
											.avatar-img {
												width: 30px;
												height: 30px;
												border-radius: 50%;
												overflow: hidden;
											}
										`});return l.querySelector(".avatar-img[data-size='small']"),l.querySelector(".avatar-img[data-size='middle']"),l.querySelector(".avatar-img[data-size='big']"),t.appendChild(e),t.appendChild(l),t.appendChild(r),t}),ue(t=>{let e=f.createElement("div",{className:"pops-panel-item-left-text",innerHTML:`
											<p class="pops-panel-item-left-main-text">å¤´åƒ</p>
											<p class="pops-panel-item-left-desc-text">å°ã€ä¸­ã€å¤§</p>
											`}),l=f.createElement("div",{className:"pops-panel-avatar-img",innerHTML:`
											<img 
												src="/uc_server/avatar.php?uid=${U.getCurrentUID()}&size=small&ts=${Date.now()}"
												class="avatar-img" data-size="small">
											<img 
												src="/uc_server/avatar.php?uid=${U.getCurrentUID()}&size=middle&ts=${Date.now()}"
												class="avatar-img" data-size="middle">
											<img 
												src="/uc_server/avatar.php?uid=${U.getCurrentUID()}&size=big&ts=${Date.now()}"
												class="avatar-img" data-size="big">
											`});return t.appendChild(e),t.appendChild(l),t}),ge("ä¿®æ”¹å¤´åƒ",`å¯ä»¥ä¸Šä¼ gifå›¾ç‰‡ï¼Œæ³¨æ„å›¾ç‰‡æœ€å¤§é™åˆ¶ä¸º${j.formatByteToSize(z.$data.avatarInfo.maxSize)}`,"ä¸Šä¼ ",void 0,!1,!1,"primary",()=>{z.init();})]}]}]}]},De={id:"component-forum-post",title:"å¸–å­",forms:[{type:"forms",text:"",forms:[{text:"åŠŸèƒ½",type:"deepMenu",forms:[{type:"forms",text:"",forms:[I("æ‹¦æˆªé™„ä»¶","mt-forum-post-interceptionAttachment",!0,void 0,"ç‚¹å‡»é™„ä»¶æ—¶å¼¹å‡ºæç¤ºæ¡†è¿›è¡Œç¡®è®¤æ˜¯å¦ä¸‹è½½é™„ä»¶"),I("å›¾ç‰‡æŸ¥çœ‹ä¼˜åŒ–","mt-forum-post-optimizationImagePreview",!0,void 0,"ä½¿ç”¨VieweræŸ¥çœ‹å›¾ç‰‡"),I("è‡ªåŠ¨åŠ è½½ä¸‹ä¸€é¡µ","mt-forum-post-loadNextPageComment",!0,void 0,"æ— ç¼é¢„è§ˆä¸‹ä¸€é¡µ"),I("ä»£ç å—ä¼˜åŒ–","mt-forum-post-codeQuoteOptimization",!0,void 0,"è‡ªåŠ¨æ£€æµ‹ä»£ç å—è¯­è¨€å¹¶è®¾ç½®å…³é”®å­—é«˜äº®")]}]},{type:"deepMenu",text:"ç”¨æˆ·ä¿¡æ¯å—",forms:[{type:"forms",text:"",forms:[I("æ¢æµ‹ç”¨æˆ·åœ¨çº¿çŠ¶æ€","mt-forum-post-detectingUserOnlineStatus",!1,void 0,"è·å–ç”¨æˆ·åœ¨çº¿çŠ¶æ€å¹¶åœ¨ç”¨æˆ·ä¿¡æ¯å¤„æ˜¾ç¤ºçŠ¶æ€è¡¨æƒ…"),I("æ˜¾ç¤ºç”¨æˆ·ç­‰çº§","mt-forum-post-showUserLevel",!0,void 0,"åœ¨ç”¨æˆ·ä¿¡æ¯å¤„æ˜¾ç¤ºå½“å‰ç”¨æˆ·çš„ç­‰çº§"),I("éšè—åº•éƒ¨ä¿¡æ¯å—","mt-forum-post-hideBottomInfoBlock",!1,void 0,"åŒ…æ‹¬é‡‘å¸ã€å¥½è¯„ã€ä¿¡èª‰ç­‰ä¿¡æ¯")]}]},{type:"deepMenu",text:"å³ä¾§æ‚¬æµ®å·¥å…·æ ",forms:[{type:"forms",text:"",forms:[I("æ–°å¢ã€å¿«æ·æ”¶è—ã€‘","mt-forum-post-quickCollentBtn",!0,void 0,"åœ¨å³ä¾§æ‚¬æµ®å·¥å…·æ æ·»åŠ ã€æ”¶è—ã€‘æŒ‰é’®ï¼Œç”¨äºå¿«æ·æ”¶è—"),I("å¿«æ·å›å¤ä¼˜åŒ–","mt-forum-post-quickReplyOptimization",!0,void 0,"ä¸ºå¿«æ·å›å¤å¼¹çª—åº•éƒ¨åŒºåŸŸæ·»åŠ ã€ä¸€é”®ç©ºæ ¼ã€‘æŒ‰é’®")]}]}]}]},K={formhash:/formhash=(.+)&/,hash:/hash=(.+)&/,uid:/uid=(\d+)/,fontSpecial:/<font.*?>|<\/font>|<strike>|<strong>|<i>|<u>|align=".*?"|<br>[\s]*<br>[\s]*<br>/g,ptid:/&ptid=([\d]+)/i,pid:/&pid=([\d]+)/i,tid:/&tid=([\d]+)/i},G={$key:{signTime:"mt-sign-time"},init(){this.sign();},todayIsSign(){let t=this.getSignTime();return !(t==null||v.formatTime(Date.now(),"yyyyMMdd")!==v.formatTime(t,"yyyyMMdd"))},setSignTime(){B(this.$key.signTime,Date.now());},getSignTime(){return q(this.$key.signTime)},clearSignTime(){ae(this.$key.signTime);},async checkLogin(){return U.envIsMobile()?document.querySelector(".sidenv_exit a[href*='member.php?mod=logging&action=logout']"):document.querySelector("#comiis_key")},getFormHash(){let t=(top||globalThis).document.querySelector("input[name=formhash]"),e=(top||globalThis).document.querySelector("div[class=sidenv_exit]>a"),l=null,r=(top||globalThis).document.querySelector("a.comiis_recommend_addkey"),a=null,s=t?t.value:null;return e&&(l=e.href.match(K.formhash),l=l?l[l.length-1]:null),r&&(a=r.href.match(K.hash),a=a?a[a.length-1]:null),s||l||a},async sign(){let t=this.getFormHash();if(t==null){if(document.querySelector("#comiis_picshowbox")){x.info("å½“å‰ä¸ºè¯„è®ºåŒºçš„çœ‹å›¾æ¨¡å¼ ");return}x.error("è‡ªåŠ¨ç­¾åˆ°ï¼šè·å–è´¦å·formhashå¤±è´¥"),ae("mt_sign"),A.error({content:"è‡ªåŠ¨ç­¾åˆ°ï¼šè·å–è´¦å·formhashå¤±è´¥"});return}if(this.todayIsSign()){x.info("ä»Šæ—¥å·²ç­¾åˆ°");return}let e={operation:"qiandao",format:"button",formhash:t,inajax:1,ajaxtarget:"midaben_sign"},l=await P.get(`/k_misign-sign.html?${v.toSearchParamsStr(e)}`,{fetch:!!w.getValue("mt-auto-sign-useFetch"),headers:{"User-Agent":v.getRandomPCUA()},allowInterceptConfig:!1});if(!l.status){x.error("ç­¾åˆ°ï¼šç½‘ç»œå¼‚å¸¸ï¼Œè¯·æ±‚å¤±è´¥"),A.error("ç­¾åˆ°ï¼šç½‘ç»œå¼‚å¸¸ï¼Œè¯·æ±‚å¤±è´¥");return}this.setSignTime(),x.info("ç­¾åˆ°ä¿¡æ¯ï¼š",l);let r=v.parseCDATA(l.data.responseText),a=f.parseHTML(`<div>${r}</div>`,!0,!1),s=f.text(a);if(s.includes("éœ€è¦å…ˆç™»å½•")){A.error("ç­¾åˆ°ï¼šè¯·å…ˆç™»å½•è´¦å·",{timeout:3e3}),this.clearSignTime();return}else if(s.includes("è¯·ç¨åå†è¯•")||s.includes("æ‚¨å·²ç»è¢«åˆ—å…¥é»‘åå•")||s.includes("ç»‘å®šæ‰‹æœºå·åæ‰å¯ä»¥ç­¾åˆ°")||s.includes("æ‚¨æ‰€åœ¨ç”¨æˆ·ç»„ä¸å…è®¸ä½¿ç”¨")){A.error("ç­¾åˆ°ï¼š"+s,{timeout:5e3});return}else if(s.includes("ä»Šæ—¥å·²ç­¾")){A.info("ç­¾åˆ°ï¼š"+s);return}else if(l.data.responseText.includes("æ‚¨å½“å‰çš„è®¿é—®è¯·æ±‚å½“ä¸­å«æœ‰éæ³•å­—ç¬¦ï¼Œå·²ç»è¢«ç³»ç»Ÿæ‹’ç»")){A.error("ç­¾åˆ°: æ‚¨å½“å‰çš„è®¿é—®è¯·æ±‚å½“ä¸­å«æœ‰éæ³•å­—ç¬¦ï¼Œå·²ç»è¢«ç³»ç»Ÿæ‹’ç»",{timeout:6e3});return}let n=a.querySelector(".con"),i=a.querySelector(".line");if(n&&i){let d=f.text(n).match(/([0-9]+)é‡‘å¸/),p=f.text(i).match(/([0-9]+)/),m=d[d.length-1],u=p[p.length-1];x.success(`é‡‘å¸${m}ï¼Œæ’å${u}`),A.info(`
                <div style="display: flex;${U.envIsMobile()?"":"padding: 20px;"}">
                    <div style="align-self: center;margin-right: 20px;">ç­¾åˆ°</div>
                    <div>æ’å ${u}<br>é‡‘å¸ ${m}</div>
                </div>`,{timeout:4e3,isHTML:!0});return}let c=te.alert({title:{text:"æœªçŸ¥ç­¾åˆ°å†…å®¹",position:"center"},content:{text:"",html:!1},width:"88vw",height:"400px"}).$shadowRoot.querySelector(".pops-alert-content");c.innerText=l.data.responseText,A.error("ç­¾åˆ°: æœªçŸ¥ç»“æœ,è¯·æŸ¥çœ‹æ§åˆ¶å°ä¿¡æ¯",{timeout:4e3});}},Le={id:"component-sigh",title:"ç­¾åˆ°",forms:[{text:"è‡ªåŠ¨ç­¾åˆ°",type:"forms",forms:[I("å¯ç”¨","mt-auto-sign",!0,void 0,"è‡ªåŠ¨è¯·æ±‚ç­¾åˆ°"),I("ä½¿ç”¨fetchè¯·æ±‚","mt-auto-sign-useFetch",!1,void 0,""),ge("ç­¾åˆ°ä¿¡æ¯",`ä¸Šæ¬¡ç­¾åˆ°æ—¶é—´ï¼š${G.getSignTime()==null?"å°šæœªç­¾åˆ°":j.formatTime(G.getSignTime())}`,"æ¸…ç©ºä¿¡æ¯",void 0,void 0,void 0,"primary",t=>{let l=t.composedPath()[0].closest("li").querySelector(".pops-panel-item-left-desc-text");R.confirm({title:{text:"æç¤º ",position:"center"},content:{text:"<p>æ˜¯å¦æ¸…ç©ºè„šæœ¬ç­¾åˆ°è®°å½•çš„æ—¶é—´?</p>",html:!0},btn:{ok:{enable:!0,callback:r=>{G.clearSignTime(),A.success("åˆ é™¤æˆåŠŸ"),f.text(l,`ä¸Šæ¬¡ç­¾åˆ°æ—¶é—´ï¼š${G.getSignTime()==null?"å°šæœªç­¾åˆ°":j.formatTime(G.getSignTime())}`),r.close();}}},mask:{enable:!0},width:"300px",height:"200px"});})]}]},Ue={id:"component-guide",title:"å¯¼è¯»",forms:[{type:"forms",text:"",forms:[I("é¡µé¢ç¾åŒ–","mt-guide-beautifyPage",!0,void 0,"ç¾åŒ–æ ·å¼")]}]},de={setting:{get width(){return window.innerWidth<550?"88vw":"550px"},get height(){return window.innerHeight<450?"70vh":"450px"}},settingBig:{get width(){return window.innerWidth<800?"92vw":"800px"},get height(){return window.innerHeight<600?"80vh":"600px"}},info:{get width(){return "350px"},get height(){return "250px"}}},w={$data:{__data:null,__oneSuccessExecMenu:null,__onceExec:null,__listenData:null,get data(){return w.$data.__data==null&&(w.$data.__data=new v.Dictionary),w.$data.__data},get oneSuccessExecMenu(){return w.$data.__oneSuccessExecMenu==null&&(w.$data.__oneSuccessExecMenu=new v.Dictionary),w.$data.__oneSuccessExecMenu},get onceExec(){return w.$data.__onceExec==null&&(w.$data.__onceExec=new v.Dictionary),w.$data.__onceExec},get scriptName(){return se},key:N,attributeKeyName:F,attributeDefaultValueName:W},$listener:{get listenData(){return w.$data.__listenData==null&&(w.$data.__listenData=new v.Dictionary),w.$data.__listenData}},init(){this.initPanelDefaultValue(),this.initExtensionsMenu();},isTopWindow(){return L.top===L.self},initExtensionsMenu(){this.isTopWindow()&&le.add([{key:"show_pops_panel_setting",text:"âš™ è®¾ç½®",autoReload:!1,isStoreValue:!1,showText(t){return t},callback:()=>{this.showPanel();}}]);},initPanelDefaultValue(){let t=this;function e(a){if(!a.attributes)return;let s={},n=a.attributes[F];n!=null&&(s[n]=a.attributes[W]);let i=a.attributes[fe];if(typeof i=="function"){let d=i();if(typeof d=="boolean"&&!d)return}let o=a.attributes[Ee];o&&typeof o=="object"&&Object.assign(s,o);let c=Object.keys(s);if(!c.length){x.warn(["è¯·å…ˆé…ç½®é”®",a]);return}c.forEach(d=>{let p=s[d];t.$data.data.has(d)&&x.warn("è¯·æ£€æŸ¥è¯¥key(å·²å­˜åœ¨): "+d),t.$data.data.set(d,p);});}function l(a){for(let s=0;s<a.length;s++){let n=a[s];e(n);let i=n.forms;i&&Array.isArray(i)&&l(i);}}let r=this.getPanelContentConfig();for(let a=0;a<r.length;a++){let s=r[a];if(!s.forms)continue;let n=s.forms;n&&Array.isArray(n)&&l(n);}},setValue(t,e){let l=q(N,{}),r=l[t];l[t]=e,B(N,l),this.$listener.listenData.has(t)&&this.$listener.listenData.get(t).callback(t,r,e);},getValue(t,e){let r=q(N,{})[t];return r??(this.$data.data.has(t)?this.$data.data.get(t):e)},deleteValue(t){let e=q(N,{}),l=e[t];Reflect.deleteProperty(e,t),B(N,e),this.$listener.listenData.has(t)&&this.$listener.listenData.get(t).callback(t,l,void 0);},addValueChangeListener(t,e,l){let r=Math.random();return this.$listener.listenData.set(t,{id:r,key:t,callback:e}),l&&l.immediate&&e(t,this.getValue(t),this.getValue(t)),r},removeValueChangeListener(t){let e=null;for(const[l,r]of this.$listener.listenData.entries())if(r.id===t){e=l;break}typeof e=="string"?this.$listener.listenData.delete(e):console.warn("æ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„ç›‘å¬å™¨");},triggerMenuValueChange(t,e,l){if(this.$listener.listenData.has(t)){let r=this.$listener.listenData.get(t);if(typeof r.callback=="function"){let a=this.getValue(t),s=a,n=a;typeof e<"u"&&arguments.length>1&&(s=e),typeof l<"u"&&arguments.length>2&&(n=l),r.callback(t,n,s);}}},hasKey(t){let e=q(N,{});return t in e},execMenu(t,e,l=!1,r){if(!(typeof t=="string"||typeof t=="object"&&Array.isArray(t)))throw new TypeError("key å¿…é¡»æ˜¯å­—ç¬¦ä¸²æˆ–è€…å­—ç¬¦ä¸²æ•°ç»„");let a=[];typeof t=="object"&&Array.isArray(t)?a=[...t]:a.push(t);let s;for(let n=0;n<a.length;n++){const i=a[n];if(!this.$data.data.has(i)){x.warn(`${t} é”®ä¸å­˜åœ¨`);return}let o=w.getValue(i);if(l&&(o=!o),typeof r=="function"){let c=r(i,o);typeof c=="boolean"&&(o=c);}if(!o)break;s=o;}s&&e(s);},execMenuOnce(t,e,l,r,a){if(typeof t!="string")throw new TypeError("key å¿…é¡»æ˜¯å­—ç¬¦ä¸²");if(!this.$data.data.has(t)){x.warn(`${t} é”®ä¸å­˜åœ¨`);return}if(this.$data.oneSuccessExecMenu.has(t))return;this.$data.oneSuccessExecMenu.set(t,1);let s=()=>{let p=w.getValue(t);return typeof l=="function"?l(t,p):p},n=[],i=p=>{let m=s(),u=[];if(p instanceof HTMLStyleElement?u=[p]:Array.isArray(p)&&(u=[...p.filter(h=>h!=null&&h instanceof HTMLStyleElement)]),m)n=n.concat(u);else for(let h=0;h<u.length;h++)u[h].remove(),u.splice(h,1),h--;},o=p=>typeof a=="function"?a(t,p):p,c=p=>{let m=[];if(o(p)){let u=e(p,i);u instanceof HTMLStyleElement?m=[u]:Array.isArray(u)&&(m=[...u.filter(h=>h!=null&&h instanceof HTMLStyleElement)]);}for(let u=0;u<n.length;u++)n[u].remove(),n.splice(u,1),u--;n=[...m];};this.addValueChangeListener(t,(p,m,u)=>{let h=u;typeof r=="function"&&(h=r(p,u,m)),c(h);});let d=s();d&&c(d);},execInheritMenuOnce(t,e,l,r){let a=this;const s=(n,i)=>{let o=a.getValue(n),c=a.getValue(i);if(typeof r=="function"){let d=r(o,c);if(d!=null)return d}return o};this.execMenuOnce(t,l,()=>s(t,e),()=>s(t,e)),this.execMenuOnce(e,()=>{},()=>!1,()=>(this.triggerMenuValueChange(t),!1));},onceExec(t,e){if(typeof t!="string")throw new TypeError("key å¿…é¡»æ˜¯å­—ç¬¦ä¸²");this.$data.onceExec.has(t)||(e(),this.$data.onceExec.set(t,1));},showPanel(){R.panel({title:{text:`${se}-è®¾ç½®`,position:"center",html:!1,style:""},content:this.getPanelContentConfig(),mask:{enable:!0,clickEvent:{toClose:!0,toHide:!1}},width:de.setting.width,height:de.setting.height,drag:!0,only:!0});},getPanelContentConfig(){return [Re,De,Le,Ue]}},Pe=()=>{var t,e,l,r,a,s,n,i,o,c,d;c=/((https?:\/\/|www\.)[\x21-\x7e]+[\w\/]|(\w[\w._-]+\.(com|cn|org|net|info|tv|cc))(\/[\x21-\x7e]*[\w\/])?|ed2k:\/\/[\x21-\x7e]+\|\/|thunder:\/\/[\x21-\x7e]+=)/gi,t=function(u){var h;if(u=(h=u.originalTarget)!=null?h:u.target,u!=null&&u.localName==="a"&&u.className.indexOf("texttolink")!==-1&&(h=u.getAttribute("href"),h.indexOf("http")!==0&&h.indexOf("ed2k://")!==0&&h.indexOf("thunder://")!==0))return u.setAttribute("href","http://"+h)},document.addEventListener("mouseover",t),o=function(u){if(typeof u=="object"&&u!=null&&typeof u.parentNode<"u"&&typeof u.parentNode.className<"u"&&typeof u.parentNode.className.indexOf=="function"&&u.parentNode.className.indexOf("texttolink")===-1&&u.nodeName!=="#cdata-section"){var h=u.textContent.replace(c,'<a href="$1" target="_blank" class="texttolink">$1</a>');if(u.textContent.length!==h.length){var g=document.createElement("span");return g.innerHTML=h,console.log(`è¯†åˆ«: ${g.querySelector("a")}`),u.parentNode.replaceChild(g,u)}}},e="a svg canvas applet input button area pre embed frame frameset head iframe img option map meta noscript object script style textarea code".split(" "),d=`//text()[not(ancestor::${e.join(") and not(ancestor::")})]`,l=new RegExp(`^(${e.join("|")})$`,"i"),a=function(u,h){var g,y;if(h+1e4<u.snapshotLength){var b=g=h;for(y=h+1e4;h<=y?g<=y:g>=y;b=h<=y?++g:--g)o(u.snapshotItem(b));setTimeout(function(){return a(u,h+1e4)},15);}else for(b=g=h,y=u.snapshotLength;h<=y?g<=y:g>=y;b=h<=y?++g:--g)o(u.snapshotItem(b));},s=function(u){return u=document.evaluate(d,u,null,XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,null),a(u,0)},n=function(u){for(u=document.createTreeWalker(u,NodeFilter.SHOW_TEXT,{acceptNode:function(h){if(!l.test(h.parentNode.localName))return NodeFilter.FILTER_ACCEPT}},!1);u.nextNode();)o(u.currentNode);},i=new window.MutationObserver(function(u){var h,g,y=0;for(h=u.length;y<h;y++){var b=u[y];if(b.type==="childList"){var _=b.addedNodes,T=0;for(g=_.length;T<g;T++)b=_[T],n(b);}}}),r=function(){return s(document.body),i.observe(document.body,{childList:!0,subtree:!0})};var p=function(u){var h=u.getAttribute("href");if(h.indexOf("http")!==0&&h.indexOf("ed2k://")!==0&&h.indexOf("thunder://")!==0)return u.setAttribute("href","http://"+h)},m=function(){for(var u=document.getElementsByClassName("texttolink"),h=0;h<u.length;h++)p(u[h]);};setTimeout(m,1500),setTimeout(r,100);},E=globalThis.location.pathname,D=globalThis.location.search;new URLSearchParams(D);const J={isKMiSign(){return E.startsWith("/k_misign-sign.html")},isPost(){return E.startsWith("/thread-")||E.startsWith("/forum.php")&&D.startsWith("?mod=viewthread")},isPage(){return !!E.match(/^\/page-([0-9]+).html/g)},isGuide(){return E.startsWith("/forum.php")&&D.startsWith("?mod=guide")},isPlate(){return !!E.match(/\/forum-[0-9]{1,2}-[0-9]{1,2}.html/g)},isSearch(){return E.startsWith("/search.php")},isSpace(){return E.startsWith("/home.php")&&D.startsWith("?mod=space")},isMySpace(){return E.startsWith("/home.php")&&D.startsWith("?mod=space&do=profile&mycenter")},isSpaceWithAt(){return E.startsWith("/space-uid-")},isForumList(){return E.startsWith("/forum.php")&&D.startsWith("?forumlist")},isMessage(){return E.startsWith("/home.php")&&D.startsWith("?mod=space&do=notice")},isMessageList(){return E.startsWith("/home.php")&&D.startsWith("?mod=space&do=pm")},isPointsMall(){return E.startsWith("/keke_integralmall-keke_integralmall.html")||E.startsWith("/plugin.php")&&D.startsWith("?id=keke_integralmal")},isPostPublish(){return E.startsWith("/forum.php")&&D.startsWith("?mod=post")},isPostPublish_voting(){return E.startsWith("/forum.php")&&D.includes("&special=1")||D.includes("&fid=42")},isPostPublish_edit(){return this.isPostPublish()&&D.includes("&action=edit")},isPostPublish_newthread(){return this.isPostPublish()&&D.includes("&action=newthread")},isPostPublish_reply(){return this.isPostPublish()&&D.includes("&action=reply")}},Ve={init(){f.ready(()=>{w.execMenuOnce("mt-forum-post-quickCollentBtn",()=>{this.quickCollentBtn();}),w.execMenuOnce("mt-forum-post-quickReplyOptimization",()=>{this.quickReplyOptimization();});});},quickCollentBtn(){x.info("ã€å¿«æ·æ”¶è—ã€‘"),v.waitNode("#scrolltop",1e4).then(t=>{if(!t)return;let e=Y('#scform input[name="formhash"]').value,l=U.getThreadId(window.location.href),r=`/home.php?${v.toSearchParamsStr({mod:"spacecp",ac:"favorite",type:"thread",id:l,formhash:e,infloat:"yes",handlekey:"k_favorite",inajax:1,ajaxtarget:"fwin_content_k_favorite"})}`,a=document.createElement("span");a.innerHTML=`
			<a href="${r}" 
				id="k_favorite"
				onclick="showWindow(this.id, this.href, 'get', 0);"
				onmouseover="this.title = $('favoritenumber').innerHTML + ' äººæ”¶è—'">
				<img src="https://s1.ax1x.com/2020/04/29/JTk3lD.gif"
						height="26" 
						width="26" 
						style="position:absolute;top:10px;left:11px">
			</a>
			`,f.prepend(t,a);});},quickReplyOptimization(){v.waitNode('#scrolltop a[title="å¿«é€Ÿå›å¤"]',1e4).then(t=>{t&&(x.info("å¿«æ·å›å¤ä¼˜åŒ–"),f.on(t,"click",function(){L.showWindow("reply",this.href),x.info("ç­‰å¾…å¼¹çª—å‡ºç°"),v.waitNode("#moreconf",1e4).then(e=>{if(!e)return;x.success("å¼¹å‡ºå‡ºç°ï¼Œæ·»åŠ æŒ‰é’®");let l=f.createElement("button",{innerText:"ä¸€é”®ç©ºæ ¼",type:"button",id:"insertspace2"},{style:"float: left;"});f.on(l,"click",r=>{v.preventEvent(r),f.val(Y("#postmessage"),f.val(Y("#postmessage"))+"           ");}),f.append(e,l);});}));});}},xe={$flag:{isSetHljsCSS:!1},init(){Ve.init(),w.execMenuOnce("mt-forum-post-autoExpandContent",()=>this.autoExpandContent()),w.execMenuOnce("mt-forum-post-repairImageWidth",()=>this.repairImageWidth()),w.execMenuOnce("mt-forum-post-hideBottomInfoBlock",()=>this.hideBottomInfoBlock()),f.ready(()=>{w.execMenu("mt-forum-post-removeFontStyle",()=>{this.removeFontStyle();}),w.execMenu("mt-forum-post-removeCommentFontStyle",()=>{this.removeCommentFontStyle();}),w.execMenuOnce("mt-forum-post-loadNextPageComment",()=>{this.loadNextPageComment();}),w.execMenuOnce("mt-forum-post-codeQuoteOptimization",()=>{this.codeQuoteOptimization();}),w.execMenuOnce("mt-forum-post-optimizationImagePreview",()=>{this.optimizationImagePreview();}),w.execMenuOnce("mt-forum-post-interceptionAttachment",()=>{this.setAttachmentsClickTip();}),w.execMenu("mt-forum-post-detectingUserOnlineStatus",()=>{this.detectingUserOnlineStatus();}),w.execMenu("mt-forum-post-showUserLevel",()=>{this.showUserLevel();});});},autoExpandContent(){return x.info("è‡ªåŠ¨å±•å¼€å¸–å­å†…å®¹"),H(`
        div.comiis_message.bg_f.view_one.b_b.cl.message>div.comiis_messages.comiis_aimg_show.cl{max-height:inherit!important;overflow-y:inherit!important;position:inherit!important}
        .comiis_lookfulltext_bg,.comiis_lookfulltext_key{display:none!important} 
        `)},repairImageWidth(){return x.info("ä¿®å¤å›¾ç‰‡å®½åº¦"),H(`
        .comiis_messages img{
            max-width: 100% !important;
        }`)},removeFontStyle(){let t=document.querySelector(".comiis_a.comiis_message_table");t&&(x.info("ç§»é™¤å¸–å­å­—ä½“æ•ˆæœ"),f.html(t,f.html(t).replace(K.fontSpecial,"")));},removeCommentFontStyle(){var l;x.info("ç§»é™¤è¯„è®ºåŒºçš„å­—ä½“æ•ˆæœ");let t=O("font"),e=((l=Y(".comiis_postlist .comiis_postli"))==null?void 0:l.innerHTML)||"";e!==""&&(t.forEach(r=>{e.includes(r.innerHTML)||(r.removeAttribute("color"),r.removeAttribute("style"),r.removeAttribute("size"));}),O(".comiis_message.message").forEach(r=>{if(e.includes(r.innerHTML)){r.innerHTML=r.innerHTML.replace(K.fontSpecial,"");let a=r.nextElementSibling;a&&a.localName==="strike"&&(a.outerHTML=a.outerHTML.replace(/^<strike>(\n|)/g,"").replace(/<\/strike>$/g,""));}})),O(".comiis_postli.comiis_list_readimgs.nfqsqi").forEach(r=>{let a=r.parentElement;a&&a.localName==="strike"&&(a.outerHTML=a.outerHTML.replace(/^<strike>(\n|)/g,"").replace(/<\/strike>$/g,""));});},loadNextPageComment(){if(x.info("è‡ªåŠ¨åŠ è½½ä¸‹ä¸€é¡µè¯„è®º"),document.title.includes("æç¤ºä¿¡æ¯ - MTè®ºå›"))return;if(O(".pgbtn").length==0){x.warn("æ²¡æœ‰æ‰¾åˆ°ä¸‹ä¸€é¡µæŒ‰é’®");return}var t=async function(r){var i,o;let a=await P.get(r,{headers:{"User-Agent":v.getRandomPCUA()},allowInterceptConfig:!1});if(!a.status){A.error("ç½‘ç»œå¼‚å¸¸ï¼Œè¯·æ±‚ä¸‹ä¸€é¡µå¤±è´¥");return}var s=v.parseFromString(a.data.responseText),n=s.querySelector(".pgbtn a");return (i=s.querySelector("#postlistreply"))==null||i.remove(),(o=s.querySelector(".bm_h.comiis_snvbt"))==null||o.remove(),{url:n?n.getAttribute("href"):null,postlist:s.querySelector("#postlist"),pgbtn:s.querySelector(".pgbtn"),pgs:s.querySelector(".pgs.mtm")}},e=async function(){var r=Y(".pgbtn a").getAttribute("href");if(r){let a=await t(r);a&&(a.url||(x.error("æœ€åä¸€é¡µï¼Œå–æ¶ˆç›‘å¬"),f.off(document,["scroll","wheel"],l.run),f.remove(".pgbtn")),a.postlist&&f.append("#postlist",f.html(a.postlist)),a.pgbtn&&f.html(".pgbtn",f.html(a.pgbtn)),a.pgs&&f.html(".pgs.mtm",f.html(a.pgs)),xe.init());}else x.error("è·å–ä¸‹ä¸€é¡µå…ƒç´ å¤±è´¥");};let l=new v.LockFunction(async()=>{v.isNearBottom()&&await e();});f.on(document,["scroll","wheel"],l.run);},codeQuoteOptimization(){x.info("ä»£ç å—ä¼˜åŒ–");function t(l){var r=["add","and","cmp","cmpg","cmpl","const","div","double","float","goto","if","int","long","move","mul","neg","new","nop","not","or","rem","return","shl","shr","sput","sub","throw","ushr","xor"],a=["aget","aput","array","check","execute","fill","filled","goto/16","goto/32","iget","instance","invoke","iput","monitor","packed","sget","sparse"],s=["transient","constructor","abstract","final","synthetic","public","private","protected","static","bridge","system"];return {aliases:["smali"],contains:[{className:"string",begin:'"',end:'"',relevance:0},l.COMMENT("#","$",{relevance:0}),{className:"keyword",variants:[{begin:"\\s*\\.end\\s[a-zA-Z0-9]*"},{begin:"^[ ]*\\.[a-zA-Z]*",relevance:0},{begin:"\\s:[a-zA-Z_0-9]*",relevance:0},{begin:"\\s("+s.join("|")+")"}]},{className:"built_in",variants:[{begin:"\\s("+r.join("|")+")\\s"},{begin:"\\s("+r.join("|")+")((\\-|/)[a-zA-Z0-9]+)+\\s",relevance:10},{begin:"\\s("+a.join("|")+")((\\-|/)[a-zA-Z0-9]+)*\\s",relevance:10}]},{className:"class",begin:`L[^(;:
]*;`,relevance:0},{begin:"[vp][0-9]+"}]}}H(`
			.hljs{text-align:left}
			.hljs ol{margin:0 0 0 10px;padding:10px 10px}
			.hljs li{padding-left:10px;list-style-type:decimal-leading-zero;font-family:Monaco,Consolas,'Lucida Console','Courier New',serif;font-size:12px;line-height:1.8em}
			.hljs li:hover{background:#2c313c}
			.hljs li::marker{unicode-bidi:isolate;font-variant-numeric:tabular-nums;text-transform:none;text-indent:0!important;text-align:start!important;text-align-last:start!important}
			.hljs em[onclick^=copycode]{color:#fff;background:#246fff;margin:5px 10px;border-radius:3px;padding:0 5px;cursor:pointer;height:32px;line-height:32px;display:inline-flex}
			.hljs .code-select-language{height:32px;line-height:32px;font-size:14px;border:1px solid #5c5c5c;border-radius:5px;text-align:center;outline:0}
		`),Q.registerLanguage("smali",t);let e=new v.LockFunction(()=>{function l(a,s="java"){a.oldValue||(a.oldValue=a.textContent),a.innerHTML=Q.highlight(a.oldValue,{language:s}).value.replace(/\\n$/gi,"");}document.querySelectorAll("em[onclick^=copycode]").forEach(a=>{if(a.nextElementSibling&&typeof a.nextElementSibling.className=="string"&&a.nextElementSibling.className=="code-select-language")return;let s=Q.highlightAuto(f.text(a.parentElement.querySelector("div[id^=code]"))).language,n=document.createElement("select"),i=Q.listLanguages().sort();i=i.concat("è‡ªåŠ¨æ£€æµ‹");let o="";i.forEach(c=>{c.startsWith("è‡ªåŠ¨æ£€æµ‹")?o+=`<option data-value="${s}" selected="selected">${c}(${s})</option>`:o+=`<option data-value="${c}">${c}</option>`;}),n.className="code-select-language",n.innerHTML=o,f.on(n,"change",()=>{let c=n.selectedOptions[0].getAttribute("data-value");x.info("åˆ‡æ¢ä»£ç å—è¯­è¨€: ",c),f.parent(n).querySelectorAll("li").forEach(d=>{l(d,c);});}),v.preventEvent(n,"click"),v.preventEvent(a,"click"),a.insertAdjacentElement("afterend",n),v.dispatchEvent(n,"change");}),document.querySelectorAll(".blockcode").forEach(a=>a.className="hljs");},this,500);v.mutationObserver(document,{config:{subtree:!0,childList:!0},callback:()=>{e.run();}});},optimizationImagePreview(){x.info("å›¾ç‰‡æŸ¥çœ‹ä¼˜åŒ–");let t=[{hostName:"avatar-bbs.mt2.cn",pathName:"*"},{hostName:"cdn-bbs.mt2.cn",pathName:"^(/static(/|//)image|/template)"},{hostName:window.location.hostname,pathName:"^(/static(/|//)image|/template)"},{hostName:window.location.hostname,pathName:"/uc_server/avatar.php"}];function e(a=[],s=0){let n="";a.forEach(c=>{n+=`<li><img data-src="${c}"></li>`;});let i=f.createElement("ul",{innerHTML:n}),o=new Me(i,{inline:!1,url:"data-src",zIndex:v.getMaxZIndex()+100,hidden:()=>{o.destroy();}});o.view(s),o.zoomTo(1),o.show();}function l(){document.querySelectorAll("#postlist .comiis_vrx:not([data-isHandlingViewIMG])").forEach(a=>{a.setAttribute("data-isHandlingViewIMG","true");let s=[];a.querySelectorAll("img").forEach(n=>{let i=n.src,o=new URL(i).hostname,c=new URL(i).pathname,d=n.parentElement;d.nodeName.toLowerCase()==="a"&&d.getAttribute("href")===i&&(d.setAttribute("href","javascript:;"),d.removeAttribute("target"));let p=!1;for(let m of t)if(o.indexOf(m.hostName)!=-1&&c.match(m.pathName)){p=!0;break}p||(s=[...s,i],n.removeAttribute("onclick"),n.setAttribute("onclick",""),f.on(n,"click",function(){x.info("ç‚¹å‡»å›¾ç‰‡",n);let m=s.findIndex(u=>u==i);e(s,m);}));});});}let r=new v.LockFunction(()=>{l();});v.mutationObserver(document,{config:{subtree:!0,childList:!0},callback:()=>{r.run();}});},setAttachmentsClickTip(){x.info("é™„ä»¶ç‚¹å‡»æé†’");function t(e){if(e.hasAttribute("href")){let l=e.hasAttribute("id")?e.id:e.parentElement.id,r=e.getAttribute("href"),a=e.innerText;if(document.querySelector(`#${l}_menu`).innerText.indexOf("é‡‘å¸")===-1)return;console.log("å‘ç°é™„ä»¶",e),console.log("è¯¥é™„ä»¶æ˜¯é‡‘å¸é™„ä»¶ï¼Œæ‹¦æˆªï¼"),e.setAttribute("data-href",r),e.style.setProperty("cursor","pointer"),e.removeAttribute("href"),e.innerText="ã€å·²æ‹¦æˆªã€‘"+a,e.onclick=function(){R.confirm({title:{text:"æç¤º",position:"center"},content:{text:`<br />ç¡®å®šèŠ±è´¹2é‡‘å¸ä¸‹è½½é™„ä»¶ <a style="color: #507daf !important;">${a}</a> ï¼Ÿ<br /><br />`,html:!0},btn:{ok:{callback:n=>{window.open(r,"_blank"),n.close();}}},mask:{enable:!0},width:"400px",height:"200px"});};}}v.mutationObserver(document.documentElement,{callback:()=>{document.querySelectorAll(".attnm a").forEach(e=>{t(e);}),document.querySelectorAll(".comiis_attach a").forEach(e=>{t(e);}),document.querySelectorAll("span[id*=attach_] a").forEach(e=>{t(e);});},immediate:!0,config:{childList:!0,subtree:!0}});},async detectingUserOnlineStatus(){var a;x.info("æ¢æµ‹ç”¨æˆ·åœ¨çº¿çŠ¶æ€");let t=Array.from(O(".pls.favatar:not([data-is-detectingUserOnlineStatus])"));function e(s){return f.createElement("img",{smilied:s?"1353":"1384",loading:"lazy",src:s?"https://cdn-bbs.mt2.cn/static/image/smiley/doge/54.png":"https://cdn-bbs.mt2.cn/static/image/smiley/doge/35.png"},{style:"border:0;float:right;"})}function l(s,n){let i=e(n);f.prepend(s,i);}for(let s=0;s<t.length;s++){const n=t[s];var r=n.querySelector(".comiis_o.cl");if(!r)return;let i=r.querySelector("a.kmfxx");if(!i)return;n.setAttribute("data-is-detectingUserOnlineStatus","true");let o=i.href,c=await P.get(o,{fetch:!0,allowInterceptConfig:!1});if(!c.status){l(n,!0);return}let p=f.parseHTML(c.data.responseText,!0,!0).querySelector(".flb");if(p){let u=((a=f.text(p))==null?void 0:a.trim()).endsWith("â€¦â€¦[ç¦»çº¿]");l(n,u);}else l(n,!0);}},showUserLevel(){x.info("æ˜¾ç¤ºç”¨æˆ·ç­‰çº§"),O(".pls.favatar:not([data-show-user-level])").forEach(t=>{t.setAttribute("data-show-user-level","true");let e="0çº§",l=t.querySelector("tr"),r=t.querySelector("p em").innerText,a=document.createElement("td");switch(a.setAttribute("style","border-left: 1px solid #e3e3e3;"),r){case"å¹¼å„¿å›­":e="1çº§";break;case"å°å­¦ç”Ÿ":e="2çº§";break;case"åˆä¸­ç”Ÿ":e="3çº§";break;case"é«˜ä¸­ç”Ÿ":e="4çº§";break;case"å¤§å­¦ç”Ÿ":e="5çº§";break;case"ç¡•å£«ç”Ÿ":e="6çº§";break;case"åšå£«ç”Ÿ":case"å®ä¹ ç‰ˆä¸»":case"ç‰ˆä¸»":case"å®¡æ ¸å‘˜":e="7çº§";break;case"åšå£«å":case"è¶…çº§ç‰ˆä¸»":case"ç½‘ç«™ç¼–è¾‘":e="8çº§";break;case"ç®¡ç†å‘˜":case"ä¿¡æ¯ç›‘å¯Ÿå‘˜":e="9çº§";break}a.innerHTML=`<p><a class="dj">${e}</a></p>Lv`,l.appendChild(a);});},hideBottomInfoBlock(){return x.info("éšè—åº•éƒ¨ä¿¡æ¯å—"),H(`
			.pls .favatar>*:not([id^="userinfo"]+div){
				display: none;
			}
			.pls .favatar>div[id^="userinfo"],
			.pls .favatar>div.tns{
				display: block;
			}
		`)}},qe={init(){f.ready(()=>{w.execMenuOnce("mt-guide-beautifyPage",()=>this.beautifyPage());});},beautifyPage(){x.info("é¡µé¢ç¾åŒ–"),H(`
			table>tbody[id^=normal]>tr{display:none}
			.xst{font-size:15px}
			td.author_img{width:50px;padding:15px 0}
			td.author_img img{width:40px;height:40px;border-radius:50%}
			.list_author{margin-top:2px;color:#999;font-size:12px}
			.bankuai_tu_by a{color:#999!important}
			.bankuai_tu_by img{height:16px;margin:1px 1px 0 0;vertical-align:top}
			tbody a:hover{text-decoration:none;color:#3498db}
			.byg_th_align em+a{margin-right:5px}
		`),O(".bm_c table tbody").forEach(t=>{let e=L.jQuery(t),l=e.find("th.common").html(),r=e.find("th.common")[0].querySelectorAll("a")[0].getAttribute("href"),a=null,s=e.find("td.by>cite>a")[0].getAttribute("href").match(/uid-(\d+)/)[1],n=`
			<td class="author_img">
				<a href="space-uid-${s}.html" c="1" mid="${a}">
					<img src="${U.getAvatar(s,"middle")}">
				</a>
			</td>
			<th colspan="3" class="new byg_th">
				<div class="byg_th_align">
					${l}
				</div>
				<div class="list_author cl">
					<span class="z">ä½œè€…:&nbsp;
						${e.find("td.by>cite>a")[0].innerHTML}
						${e.find("td.by>em>span")[0].innerHTML}
					</span>
					<span class="z pipe">&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;</span>
					<span class="z">æœ€åå‘è¡¨:&nbsp;
						${e.find("td.by>cite>a")[1].innerHTML}&nbsp;&nbsp;&nbsp;
						${e.find("td.by>em>a")[0].innerHTML}
					</span>
					<span class="y bankuai_tu_by">
						<a href="${r}">
						<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACOUlEQVRYR+1X0XETMRDdtfRP0gFUgG9O+iZUAKmApAJMBZgKMBUQKohTQcy3dHOmApIOzL/lZTbc3eh0ki/kfMkww37Zlkbv7e7bJxnhiQOfGB/+HQJlWR45594AwAkAvAWAo6B6GwBYAsBKCHGVZRl/743eCjDwbrd7T0SzCGgKYIOIi8lk8qWPyF4C1lrO9OtfAIeEuArnSimuTDSSBIqiOCMiBh8ciPghz/NF7KAogUOC16CIeJ7n+UVIokPAGHOCiNeD044cQESvtdYrf6lDwFq7BoCXIxFYa62zJIFKdJdjgHtnnvqibFXAWss9ejcygW9KqbNGGz6YtZbH5tnIBDZKqeMUAQrBieiT1noemYwfQgj2CXDO8Zw3uqkVb4yZI+LH8EylVFP55kNZllPnXLlvszFmhYiveI8/20VRzIjoM/9ORN+11mzXd2Gt7SQlhMiyLGOxty+j2OZ6dKq74Kfnikul1GkFwhXge4JjI4R4wRacGuloBVJsq0N5dqehJRPRnywQec0P1hKvNZXwF5ME/BKPKMQrpdSddjotGMOCw0RCS275QNXnmxFH8VYIMfWv6I4V+4oeoQ0tF+y0wBsdX9WH4tFywKgG6h+rVrDyD3UpRcGTFfAqMfhuqJ00Vca9T7IhbwN2RCnlrHa8xyJwyy9jIlqGD4+DEOCsAGAupbzZbrfP/UOllOu+F3CMxN4WeMb0CxFnsTfd0BHp08CcAaSUi4dkdx9yvX9M7nPIkD3/CfwGBboJMIftEqkAAAAASUVORK5CYII=" />${e.find("td.num>a")[0].innerText}
						</a>&nbsp;
					</span>
					<span class="y bankuai_tu_by" style="margin-right: 20px">
						<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACVElEQVRYR+1W3W3bQAwmTb83GzSdoDnr7rn2BukETSeoO0HtCdpO0GSCeoPYzzrhnA3sDZJ3yywYSIIk352sOIBRIHwTxCM/kh9/EM4seGb/8Abg/8mAc+4yz/NPAHANAFcAcNnizwYA1gCwIKKVUkq+O6UzA4XjHwBw02mtqXBLRPMuIFEAaZrOEFGcv1gQcZYkyTxkwAvAOXex2+3uEVFSfbIw83o4HE6UUo9tYwcAnHNXeZ7/9dS4/nYrtUbE5zozs/BBuPE+gnZDRAKiwY0GgCMif0LEaZIktz5HWZbdMPMvAHjn++/LRAOAtVZY/DEQxRMRjZVSohOUIoPLGAhjjCoNVACstYL8W5AsiF/bkadpOiYiHo1Gq/q7IhN/Ijh/a62n8v8ZgBhCxPvIg63Wuup7D0+kvp/r2bHWSq2DnGDmiTFmWQJYIqIMmZBUiEUhYHyjtf5QGujKKAAstdYTtNYKe4X1QUHE70mSSImi2SqjEr0sy6bM/DNmV/TPD6CI6jVK0OBJVwmYeWWMGR9LwkZ9CxIuaiTbEtF1HxISkRL9k9tQMihs7tOGzDw3xsyqNqwxNzaIHotReswgkpa+CBDwQWtd7ZiDUZznuUQTmoayTKZa6zuf8WIACfODzotpWi0l3zKSw0NARBcLMzeWESJKO7ePlDrOh7bzgxKU2rKUOjIRa2/fP6/zIIDSwmscJHXC+ZAde5IJY7/0DPuOiGYnnWR1h3Ib7vf7MTOXR2mbI3KkrBFxMRgMFr7r50UZ6Bl1b/XOEvS22PPBG4CzZ+AfrntRcuAjU2wAAAAASUVORK5CYII=" />${e.find("td.num>em")[0].innerText}
					</span>
				</div>
			</th>
			`,i=L.jQuery(n);L.jQuery(i.find(".byg_th_align")[0].children[0]).before(`<em>[${e.find("tr>td.by>a")[0].outerHTML}]</em>`),e.html(i);});}},ee=function(t,e,l,r,a,s="",n,i,o){let c={text:t,type:"input",isNumber:!!n,isPassword:!!i,props:{},attributes:{},description:r,afterAddToUListCallBack:o,getValue(){return this.props[S].get(e,l)},callback(d,p,m){this.props[S].set(e,n?m:p);},placeholder:s};return Reflect.set(c.attributes,F,e),Reflect.set(c.attributes,W,l),Reflect.set(c.props,S,{get(d,p){return w.getValue(d,p)},set(d,p){w.setValue(d,p);}}),c},ie=function(t,e,l,r,a,s="",n){let i={text:t,type:"textarea",attributes:{},props:{},description:r,placeholder:s,disabled:n,getValue(){return this.props[S].get(e,l)},callback(o,c){this.props[S].set(e,c);}};return Reflect.set(i.attributes,F,e),Reflect.set(i.attributes,W,l),Reflect.set(i.props,S,{get(o,c){return w.getValue(o,c)},set(o,c){w.setValue(o,c);}}),i};class ve{constructor(e){Z(this,"option");this.option=e;}showView(){var n;let e=R.confirm({title:{text:this.option.title,position:"center"},content:{text:`
                    <form class="rule-form-container" onsubmit="return false">
                        <ul class="rule-form-ulist">
                            
                        </ul>
                        <input type="submit" style="display: none;" />
                    </form>
                    `,html:!0},btn:v.assign({ok:{callback(){s();}}},this.option.btn||{},!0),mask:{enable:!0},style:`
                ${R.config.cssText.panelCSS}
                
                .rule-form-container {
                    
                }
                .rule-form-container li{
                    display: flex;
                    align-items: center;
                    justify-content: space-between;
                    padding: 5px 20px;
                    gap: 10px;
                }
                .pops-panel-item-left-main-text{
                    max-width: 150px;
                }
                .pops-panel-item-right-text{
                    padding-left: 30px;
                }
                .pops-panel-item-right-text,
                .pops-panel-item-right-main-text{
                    text-overflow: ellipsis;
                    overflow: hidden;
                    white-space: nowrap;
                }

                ${((n=this.option)==null?void 0:n.style)??""}
            `,width:window.innerWidth>500?"500px":"88vw",height:window.innerHeight>500?"500px":"80vh"}),l=e.$shadowRoot.querySelector(".rule-form-container");e.$shadowRoot.querySelector("input[type=submit]");let r=e.$shadowRoot.querySelector(".rule-form-ulist"),a=this.option.getView(this.option.data());r.appendChild(a);const s=()=>{this.option.onsubmit(l,this.option.data()).success&&(e.close(),this.option.dialogCloseCallBack(!0));};}}const Ne={$el:{isFilterElementHTML:[]},$key:{STORAGE_KEY:"mt-post-comment-filter-rule"},init(){if(this.registerMenu(),J.isPost()){let t=this.getData();if(!t.enable)return;let e=new v.LockFunction(()=>{this.runFilter(t);});v.mutationObserver(document,{config:{subtree:!0,childList:!0},callback:()=>{e.run();}});}},registerMenu(){le.add({key:"comment-filter",text:"âš™ è¯„è®ºè¿‡æ»¤å™¨",autoReload:!1,isStoreValue:!1,showText(t){return t},callback:()=>{this.showView();}});},runFilter(t){let e=function(r){for(const a of t.userBlackList)if(a==r.userName||a==r.userUID)return x.success("è¯„è®ºè¿‡æ»¤å™¨ï¼šé»‘åå•ç”¨æˆ·",r),!0;return !1},l=function(r){for(const a of t.userWhiteList)if(a===r.userName||a===r.userUID)return x.success("è¯„è®ºè¿‡æ»¤å™¨ï¼šç™½åå•ç”¨æˆ·",r),!0;return !1};document.querySelectorAll(".comiis_vrx").forEach(r=>{var s,n,i,o,c,d,p;if(r.querySelector(".plc .pti .authi .show"))return;let a={userName:((s=r.querySelector(".pls .authi a"))==null?void 0:s.innerText)||"",userUID:((c=(o=(i=(n=r.querySelector(".pls .authi a"))==null?void 0:n.href)==null?void 0:i.match(K.uid))==null?void 0:o[1])==null?void 0:c.trim())||"",content:((p=(d=r.querySelector(".plc td.t_f"))==null?void 0:d.innerText)==null?void 0:p.trim())||"",isAuthor:!1};if(!l(a)){if(t.replyFlag&&r.querySelector(".quote")){let m=r.querySelector(".quote");this.$el.isFilterElementHTML.push(m.outerHTML),m.remove();}if(!(a.isAuthor&&!t.avatarFlag)){if(e(a)){this.$el.isFilterElementHTML.push(r.outerHTML),r.remove();return}if(!(typeof t.minLength=="number"&&t.minLength>a.content.length)&&!(typeof t.keywordLength=="number"&&t.keywordLength<a.content.length))for(const m of t.keywords){if(typeof m!="string")continue;let u=new RegExp(m);if(a.content.match(u)){console.log("è¯„è®ºè¿‡æ»¤å™¨ï¼š",a),this.$el.isFilterElementHTML.push(r.outerHTML),r.remove();return}}}}});},showView(){const t=this;function e(a){return {get(s,n){let i=t.getData(),o=Reflect.get(i,s,n);return (s==="keywords"||s==="userWhiteList"||s==="userBlackList")&&(o=o.join(`
`)),o},set(s,n){(s==="keywords"||s==="userWhiteList"||s==="userBlackList")&&(n=n.split(`
`).filter(i=>i.trim()!="")),Reflect.set(a,s,n),t.setData(a);}}}let l=R.config.panelHandleContentUtils();new ve({title:"è¯„è®ºè¿‡æ»¤å™¨",data:()=>this.getData(),getView:a=>{let s=document.createDocumentFragment(),n=I("å¯ç”¨","enable",!0);Reflect.set(n.props,S,e(a));let i=l.createSectionContainerItem_switch(n),o=I("å¤„ç†å›å¤å¼•ç”¨","replyFlag",!1,void 0,"ç§»é™¤å¼•ç”¨");Reflect.set(o.props,S,e(a));let c=l.createSectionContainerItem_switch(o),d=I("å¤„ç†ä½œè€…è¯„è®º","avatarFlag",!1);Reflect.set(d.props,S,e(a));let p=l.createSectionContainerItem_switch(d),m=I('å¤„ç†ä»"æœç´¢é¡µé¢"æˆ–"æˆ‘çš„å¸–å­æé†’é¡µé¢"è¿›å…¥çš„ç½‘ç«™',"viewthreadFlag",!1);Reflect.set(m.props,S,e(a));let u=l.createSectionContainerItem_switch(m),h=ee("åŒ¹é…çš„è¯„è®ºå†…å®¹é•¿åº¦æœ€å°å€¼","minLength",5,"å°äºæ­¤é•¿åº¦çš„è¯„è®ºå°±ç®—å…³é”®å­—åŒ¹é…æˆåŠŸäº†ä¹Ÿä¸ä¼šè¢«æ’é™¤",void 0,"",!0);Reflect.set(h.props,S,e(a));let g=l.createSectionContainerItem_input(h),y=ee("åŒ¹é…çš„è¯„è®ºå†…å®¹é•¿åº¦æœ€å¤§å€¼","keywordLength",8,"å¤§äºæ­¤é•¿åº¦çš„è¯„è®ºå°±ç®—å…³é”®å­—åŒ¹é…æˆåŠŸäº†ä¹Ÿä¸ä¼šè¢«æ’é™¤",void 0,"",!0);Reflect.set(y.props,S,e(a));let b=l.createSectionContainerItem_input(y),_=ie("è¯„è®ºå…³é”®å­—","keywords","","å¤šä¸ªè¯„è®ºå…³é”®å­—æ¢è¡Œåˆ†å‰²");Reflect.set(_.props,S,e(a));let T=l.createSectionContainerItem_textarea(_),C=ie("é»‘åå•ç”¨æˆ·","userBlackList","","å¤šä¸ªç”¨æˆ·æ¢è¡Œåˆ†å‰²");Reflect.set(C.props,S,e(a));let $=l.createSectionContainerItem_textarea(C),k=ie("ç™½åå•ç”¨æˆ·","userWhiteList","","å¤šä¸ªç”¨æˆ·æ¢è¡Œåˆ†å‰²");Reflect.set(k.props,S,e(a));let M=l.createSectionContainerItem_textarea(k);return s.append(i,c,p,u,g,b,T,$,M),s},btn:{merge:!0,position:"space-between",ok:{enable:!1},cancel:{enable:!0,text:"å…³é—­"},other:{enable:!0,text:`æŸ¥çœ‹å·²è¿‡æ»¤ï¼ˆ${this.$el.isFilterElementHTML.length}ï¼‰`,type:"primary",callback:(a,s)=>{R.alert({title:{text:"è¯„è®ºè¿‡æ»¤å™¨-å·²è¿‡æ»¤",position:"center"},content:{text:`
                                ${Array.from(document.querySelectorAll('link[rel="stylesheet"]')).map(n=>n.outerHTML).join(`
`)}

                                ${this.$el.isFilterElementHTML.join(`
`)}
                                `,html:!0},mask:{enable:!0},style:`
							.plhin{
								width: 100%;
							}
							td.plc .pi{
								height: auto;
							}
							`,width:"88vw",height:"80vh"});}}},dialogCloseCallBack(a){},onsubmit:(a,s)=>({success:!0,data:s}),style:`
            .pops-panel-item-left-desc-text{
                line-height: normal;
                margin-top: 6px;
                font-size: 0.8em;
                color: rgb(108, 108, 108);
            }
            .pops-panel-item-left-main-text{
                max-width: unset;
            }
            .pops-panel-textarea textarea{
                height: 150px;
            }
            `}).showView();},getTemplateData(){return {enable:!0,avatarFlag:!1,replyFlag:!1,viewthreadFlag:!1,minLength:5,keywordLength:8,keywords:[],userBlackList:[],userWhiteList:[]}},getData(){return q(this.$key.STORAGE_KEY,this.getTemplateData())},setData(t){B(this.$key.STORAGE_KEY,t);}};class Oe{constructor(e){Z(this,"option");this.option=e;}showView(){let e=R.alert({title:{text:this.option.title,position:"center"},content:{text:`
                <div class="filter-container"></div>
                `},btn:{ok:{text:"å…³é—­",type:"default"}},mask:{enable:!0},width:window.innerWidth>500?"350px":"80vw",height:window.innerHeight>500?"300px":"70vh",style:`
            .filter-container{
                height: 100%;
                display: flex;
                flex-direction: column;
                gap: 20px;
            }
            .filter-container button{
                text-wrap: wrap;
                padding: 8px;
                height: auto;
                text-align: left;
            }
            `}),l=e.$shadowRoot.querySelector(".filter-container"),r=document.createDocumentFragment();this.option.filterOption.forEach(a=>{let s=document.createElement("button");s.innerText=a.name;let n=()=>{this.option.getAllRuleInfo().forEach(i=>{a.filterCallBack(i.data)?f.show(i.$el,!1):f.hide(i.$el,!1);}),typeof this.option.execFilterCallBack=="function"&&this.option.execFilterCallBack(),e.close();};f.on(s,"click",i=>{v.preventEvent(i),!(typeof a.callback=="function"&&!a.callback(i,n))&&n();}),r.appendChild(s);}),l.appendChild(r);}}class ze{constructor(e){Z(this,"option");this.option=e;}showView(){var r,a,s,n,i,o,c,d,p;let e=R.confirm({title:{text:this.option.title,position:"center"},content:{text:`
                    <div class="rule-view-container">
                    </div>
                    `,html:!0},btn:{merge:!0,reverse:!1,position:"space-between",ok:{enable:((s=(a=(r=this.option)==null?void 0:r.bottomControls)==null?void 0:a.add)==null?void 0:s.enable)||!0,type:"primary",text:"æ·»åŠ ",callback:m=>{this.showEditView(e.$shadowRoot,!1,this.option.getAddData());}},close:{enable:!0,callback(m){e.close();}},cancel:{enable:((o=(i=(n=this.option)==null?void 0:n.bottomControls)==null?void 0:i.filter)==null?void 0:o.enable)||!1,type:"default",text:"è¿‡æ»¤",callback:(m,u)=>{var y,b,_,T,C,$,k;typeof((_=(b=(y=this.option)==null?void 0:y.bottomControls)==null?void 0:b.filter)==null?void 0:_.callback)=="function"&&this.option.bottomControls.filter.callback();let h=()=>Array.from(e.$shadowRoot.querySelectorAll(".rule-view-container .rule-item")),g=u.target.closest(".pops-confirm-btn").querySelector(".pops-confirm-btn-cancel span");f.text(g).includes("å–æ¶ˆ")?(h().forEach(M=>{f.show(M,!1);}),f.text(g,"è¿‡æ»¤")):new Oe({title:((C=(T=this.option.bottomControls)==null?void 0:T.filter)==null?void 0:C.title)??"è¿‡æ»¤è§„åˆ™",filterOption:((k=($=this.option.bottomControls)==null?void 0:$.filter)==null?void 0:k.option)||[],execFilterCallBack(){f.text(g,"å–æ¶ˆè¿‡æ»¤");},getAllRuleInfo:()=>h().map(V=>({data:this.parseRuleItemElement(V).data,$el:V}))}).showView();}},other:{enable:((p=(d=(c=this.option)==null?void 0:c.bottomControls)==null?void 0:d.clear)==null?void 0:p.enable)||!0,type:"xiaomi-primary",text:`æ¸…ç©ºæ‰€æœ‰(${this.option.data().length})`,callback:m=>{let u=R.confirm({title:{text:"æç¤º",position:"center"},content:{text:"ç¡®å®šæ¸…ç©ºæ‰€æœ‰çš„æ•°æ®ï¼Ÿ",html:!1},btn:{ok:{enable:!0,callback:h=>{var g,y,b;if(x.success("æ¸…ç©ºæ‰€æœ‰"),typeof((b=(y=(g=this.option)==null?void 0:g.bottomControls)==null?void 0:y.clear)==null?void 0:b.callback)=="function"&&this.option.bottomControls.clear.callback(),this.option.data().length){A.error("æ¸…ç†å¤±è´¥");return}else A.success("æ¸…ç†æˆåŠŸ");this.updateDeleteAllBtnText(e.$shadowRoot),this.clearContent(e.$shadowRoot),u.close();}},cancel:{text:"å–æ¶ˆ",enable:!0}},mask:{enable:!0},width:"300px",height:"200px"});}}},mask:{enable:!0},width:window.innerWidth>500?"500px":"88vw",height:window.innerHeight>500?"500px":"80vh",style:`
            ${R.config.cssText.panelCSS}
            
            .rule-item{
                display: flex;
                align-items: center;
                line-height: normal;
                font-size: 16px;
                padding: 4px 4px;
                gap: 6px;
            }
            .rule-name{
                flex: 1;
                white-space: nowrap;
                text-overflow: ellipsis;
                overflow: hidden;
            }
            .rule-controls{
                display: flex;
                align-items: center;
                text-overflow: ellipsis;
                overflow: hidden;
                white-space: nowrap;
                gap: 8px;
                padding: 0px 4px;
            }
            .rule-controls-enable{
                
            }
            .rule-controls-edit{
                
            }
            .rule-controls-delete{
                
            }
            .rule-controls-edit,
            .rule-controls-delete{
                width: 16px;
                height: 16px;
                cursor: pointer;
            }
            `});this.option.data().forEach(m=>{this.appendRuleItemElement(e.$shadowRoot,m);});}parseViewElement(e){let l=e.querySelector(".rule-view-container"),r=e.querySelector(".pops-confirm-btn button.pops-confirm-btn-other");return {$container:l,$deleteBtn:r}}parseRuleItemElement(e){let l=e.querySelector(".rule-controls-enable"),r=l.querySelector(".pops-panel-switch"),a=l.querySelector(".pops-panel-switch__input"),s=l.querySelector(".pops-panel-switch__core"),n=e.querySelector(".rule-controls-edit"),i=e.querySelector(".rule-controls-delete");return {$enable:l,$enableSwitch:r,$enableSwitchInput:a,$enableSwitchCore:s,$edit:n,$delete:i,data:Reflect.get(e,"data-rule")}}createRuleItemElement(e,l){let r=this.option.getDataItemName(e),a=f.createElement("div",{className:"rule-item",innerHTML:`
			<div class="rule-name">${r}</div>
			<div class="rule-controls">
				<div class="rule-controls-enable">
					<div class="pops-panel-switch">
						<input class="pops-panel-switch__input" type="checkbox">
						<span class="pops-panel-switch__core">
							<div class="pops-panel-switch__action">
							</div>
						</span>
					</div>
				</div>
				<div class="rule-controls-edit">
					${R.config.iconSVG.edit}
				</div>
				<div class="rule-controls-delete">
					${R.config.iconSVG.delete}
				</div>
			</div>
			`});Reflect.set(a,"data-rule",e);let s="pops-panel-switch-is-checked";const{$enable:n,$enableSwitch:i,$enableSwitchCore:o,$enableSwitchInput:c,$delete:d,$edit:p}=this.parseRuleItemElement(a);return this.option.itemControls.enable.enable?(f.on(o,"click",m=>{let u=!1;i.classList.contains(s)?(i.classList.remove(s),u=!1):(i.classList.add(s),u=!0),c.checked=u,this.option.itemControls.enable.callback(e,u);}),this.option.itemControls.enable.getEnable(e)&&i.classList.add(s)):n.remove(),this.option.itemControls.edit.enable?f.on(p,"click",m=>{v.preventEvent(m),this.showEditView(l,!0,e,a,u=>{e=null,e=u;});}):p.remove(),this.option.itemControls.delete.enable?f.on(d,"click",m=>{v.preventEvent(m);let u=R.confirm({title:{text:"æç¤º",position:"center"},content:{text:"ç¡®å®šåˆ é™¤è¯¥æ¡æ•°æ®ï¼Ÿ",html:!1},btn:{ok:{enable:!0,callback:h=>{x.success("åˆ é™¤æ•°æ®"),this.option.itemControls.delete.deleteCallBack(e)?(A.success("æˆåŠŸåˆ é™¤è¯¥æ•°æ®"),a.remove(),this.updateDeleteAllBtnText(l),u.close()):A.error("åˆ é™¤è¯¥æ•°æ®å¤±è´¥");}},cancel:{text:"å–æ¶ˆ",enable:!0}},mask:{enable:!0},width:"300px",height:"200px"});}):d.remove(),a}appendRuleItemElement(e,l){const{$container:r}=this.parseViewElement(e);if(Array.isArray(l))for(let a=0;a<l.length;a++){const s=l[a];r.appendChild(this.createRuleItemElement(s,e));}else r.appendChild(this.createRuleItemElement(l,e));this.updateDeleteAllBtnText(e);}updateRuleContaienrElement(e){this.clearContent(e),this.parseViewElement(e);let l=this.option.data();this.appendRuleItemElement(e,l),this.updateDeleteAllBtnText(e);}updateRuleItemElement(e,l,r){let a=this.createRuleItemElement(e,r);l.after(a),l.remove();}clearContent(e){const{$container:l}=this.parseViewElement(e);f.html(l,"");}setDeleteBtnText(e,l,r=!1){const{$deleteBtn:a}=this.parseViewElement(e);r?f.html(a,l):f.text(a,l);}updateDeleteAllBtnText(e){let l=this.option.data();this.setDeleteBtnText(e,`æ¸…ç©ºæ‰€æœ‰(${l.length})`);}showEditView(e,l,r,a,s){let n=o=>{if(!o){if(l||this.option.deleteData(r),typeof s=="function"){let c=this.option.getData(r);s(c);}}};new ve({title:l?"ç¼–è¾‘":"æ·»åŠ ",data:()=>r,dialogCloseCallBack:n,getView:o=>this.option.itemControls.edit.getView(o,l),btn:{ok:{enable:!0,text:l?"ä¿®æ”¹":"æ·»åŠ "},cancel:{callback(o,c){o.close(),n(!1);}},close:{callback(o,c){o.close(),n(!1);}}},onsubmit:(o,c)=>{let d=this.option.itemControls.edit.onsubmit(o,l,c);return d.success?l?(A.success("ä¿®æ”¹æˆåŠŸ"),this.updateRuleItemElement(d.data,a,e)):this.appendRuleItemElement(e,d.data):l&&A.error("ä¿®æ”¹å¤±è´¥"),d},style:this.option.itemControls.edit.style}).showView();}}const He={$key:{STORAGE_KEY:"mt-productListingReminder-rule"},init(){this.registerMenu(),this.runRule();},registerMenu(){le.add({key:"product-reminder",text:"âš™ å•†å“ä¸Šæ¶æé†’",autoReload:!1,isStoreValue:!1,showText(t){return t},callback:()=>{this.showView();}});},async runRule(){async function t(){let r=await P.get("/keke_integralmall-keke_integralmall.html",{allowInterceptConfig:!1,headers:{"User-Agent":v.getRandomAndroidUA()}});if(!r.status){A.error("ã€ç§¯åˆ†å•†åŸã€‘è·å–æ•°æ®å¤±è´¥");return}let a=[];return f.parseHTML(r.data.responseText,!0,!0).querySelectorAll(".task-list-wrapper li.col-xs-12").forEach(n=>{var i,o;a.push({name:f.text(n.querySelector(".mall-info a > *:first-child"))||f.text(n.querySelector(".mall-info a")),price:f.text(n.querySelector(".mall-info span.discount-price i")),endTime:f.text(n.querySelector(".mall-info #time_hz span.time")),remainingQuantity:parseInt(((o=(i=n.querySelector(".mall-info .mall-count .count-r"))==null?void 0:i.innerText)==null?void 0:o.replace(/ä»…å‰©|ä»¶/gi,""))||"0")});}),a}if(J.isPointsMall())return;let e=this.getData();if(!e.length)return;let l=await t();if(l){for(const r of l)for(const a of e)if(a.enable&&r.name.match(new RegExp(a.productName,"i"))&&!isNaN(r.remainingQuantity)&&r.remainingQuantity>0){x.success("æˆåŠŸåŒ¹é…å¯¹åº”å•†å“",a,r),R.confirm({title:{text:"ç§¯åˆ†å•†åŸæé†’",position:"center"},content:{text:`<br />
                            æ‚¨è®¾ç½®çš„å•†å“å·²ä¸Šæ¶åœ¨ç§¯åˆ†å•†åŸä¸­ï¼Œå½“å‰å”®ä»· ${r.price}é‡‘å¸ï¼Œä»…å‰©${r.remainingQuantity}ä»¶ï¼Œæ˜¯å¦å‰å¾€è´­ä¹°ï¼Ÿ
                            <a style="color: red !important;">(å¦‚éœ€å…³é—­æé†’ï¼Œè¯·åˆ é™¤è¯¥å…³é”®å­—)</a>
                            <br />`,html:!0},btn:{merge:!0,position:"space-between",other:{enable:!0,type:"danger",text:"åˆ é™¤æé†’",callback:()=>{this.deleteData(a)?A.success("åˆ é™¤æˆåŠŸ"):A.error("åˆ é™¤å¤±è´¥");}},ok:{text:"å‰å¾€è´­ä¹°",callback:()=>{window.location.href=`${window.location.origin}/keke_integralmall-keke_integralmall.html`;}}},width:"300px",height:"300px"});return}}},getTemplateData(){return {uuid:v.generateUUID(),enable:!0,name:"",productName:""}},showView(){let t=R.config.panelHandleContentUtils();function e(r){return {get(a,s){return r[a]??s},set(a,s){r[a]=s;}}}new ze({title:"å•†å“ä¸Šæ¶æé†’",data:()=>this.getData(),getAddData:()=>this.getTemplateData(),getDataItemName:r=>r.name,updateData:r=>this.updateData(r),deleteData:r=>this.deleteData(r),getData:r=>this.getData().find(n=>n.uuid===r.uuid)??r,itemControls:{enable:{enable:!0,getEnable(r){return r.enable},callback:(r,a)=>{r.enable=a,this.updateData(r);}},edit:{enable:!0,getView:(r,a)=>{let s=document.createDocumentFragment();a||(r=this.getTemplateData());let n=I("å¯ç”¨","enable",!0);Reflect.set(n.props,S,e(r));let i=t.createSectionContainerItem_switch(n),o=ee("è§„åˆ™åç§°","name","","",void 0,"å¿…å¡«");Reflect.set(o.props,S,e(r));let c=t.createSectionContainerItem_input(o),d=ee("å•†å“å","productName","","",void 0,"å¯æ­£åˆ™ï¼Œéœ€æ‰‹åŠ¨è½¬ä¹‰");Reflect.set(d.props,S,e(r));let p=t.createSectionContainerItem_input(d);return s.append(i,c,p),s},onsubmit:(r,a,s)=>{let n=r.querySelectorAll(".rule-form-ulist > li"),i=this.getTemplateData();return a&&(i.uuid=s.uuid),n.forEach(o=>{let c=Reflect.get(o,"__formConfig__"),d=Reflect.get(c,"attributes"),p=Reflect.get(o,S),m=Reflect.get(d,F),u=Reflect.get(d,W),h=p.get(m,u);Reflect.has(i,m)?Reflect.set(i,m,h):x.error(`${m}ä¸åœ¨æ•°æ®ä¸­`);}),i.name.trim()===""?(A.error("è§„åˆ™åç§°ä¸èƒ½ä¸ºç©º"),{success:!1,data:i}):a?{success:this.updateData(i),data:i}:{success:this.addData(i),data:i}}},delete:{enable:!0,deleteCallBack:r=>this.deleteData(r)}}}).showView();},getData(){return q(this.$key.STORAGE_KEY,[])},setData(t){B(this.$key.STORAGE_KEY,t);},addData(t){let e=this.getData();return e.findIndex(r=>r.uuid==t.uuid)===-1?(e.push(t),B(this.$key.STORAGE_KEY,e),!0):!1},updateData(t){let e=this.getData(),l=e.findIndex(a=>a.uuid==t.uuid),r=!1;return l!==-1&&(r=!0,e[l]=t),this.setData(e),r},deleteData(t){let e=this.getData(),l=e.findIndex(a=>a.uuid==t.uuid),r=!1;return l!==-1&&(r=!0,e.splice(l,1)),this.setData(e),r},clearData(){ae(this.$key.STORAGE_KEY);}},Be={$flag:{showUserUID_initCSS:!1},init(){w.onceExec("mt-MTCommentFilter",()=>{Ne.init();}),J.isPost()?(x.info("Router: å¸–å­"),xe.init()):J.isGuide()?(x.info("Router: å¯¼è¯»"),qe.init()):x.error("Router: æœªé€‚é…çš„é“¾æ¥ ==> "+window.location.href),f.ready(()=>{w.onceExec("mt-MTProductListingReminder",()=>{He.init();}),w.execMenuOnce("mt-link-text-to-hyperlink",()=>{Pe();}),w.execMenuOnce("mt-addLatestPostBtn",()=>{this.addLatestPostBtn();}),w.execMenu("mt-auto-sign",()=>{G.init();});});},addLatestPostBtn(){x.info("æ–°å¢ã€æœ€æ–°å‘è¡¨ã€‘"),f.append("#comiis_nv .wp.comiis_nvbox.cl ul",`
			<li id="latest_publication">
				<a href="/forum.php?mod=guide&view=newthread" hidefocus="true" title="æœ€æ–°å‘è¡¨">æœ€æ–°å‘è¡¨</a>
			</li>
		`),window.location.href.includes("/forum.php?mod=guide&view=newthread")&&(f.removeClass("#mn_forum_10","a"),f.css("#latest_publication a","background",'url("https://cdn-bbs.mt2.cn/template/comiis_mi/img/nv_a.png") repeat-x 50% -50px'));}};w.init();Be.init();});Fe();

})(Qmsg, DOMUtils, Utils, pops, hljs, Viewer);